<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒæƒ…å¤©æ°”ç«™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 30px 50px;
            max-width: 500px;
            width: 100%;
            animation: fadeIn 0.5s ease-in;
            display: block !important;
            opacity: 1 !important;
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 10px;
                align-items: flex-start;
                padding-top: 10px;
            }

            .container {
                padding: 20px;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            }

            h1 {
                font-size: 22px !important;
                margin-bottom: 20px !important;
            }

            .mood-options {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 8px !important;
            }

            .mood-btn {
                padding: 12px !important;
                font-size: 20px !important;
            }

            .mood-btn span {
                font-size: 12px !important;
            }

            input[type="text"], textarea {
                font-size: 16px !important;
            }

            .submit-btn {
                padding: 12px !important;
                font-size: 16px !important;
            }

            .weather-card {
                padding: 15px !important;
            }

            .city-name {
                font-size: 20px !important;
            }

            .temperature {
                font-size: 36px !important;
            }

            .quote-card {
                padding: 20px !important;
            }

            .quote-text {
                font-size: 16px !important;
            }

            /* å¯¼èˆªæŒ‰é’®åœ¨ç§»åŠ¨ç«¯æ›´å° */
            .container > div[style*="text-align: center"] a {
                padding: 10px 20px !important;
                font-size: 14px !important;
            }
        }

        /* è¶…å°å±å¹•ä¼˜åŒ– */
        @media (max-width: 375px) {
            .container {
                padding: 15px !important;
            }

            h1 {
                font-size: 20px !important;
            }

            .mood-options {
                grid-template-columns: repeat(2, 1fr) !important;
            }

            .mood-btn {
                padding: 10px !important;
                font-size: 18px !important;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .update-status {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #2e7d32;
        }

        .update-status.updating {
            background: #fff3e0;
            color: #e65100;
        }

        .update-status.error {
            background: #ffebee;
            color: #c62828;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .mood-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .mood-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 24px;
        }

        .mood-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .mood-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .mood-btn span {
            display: block;
            font-size: 14px;
            margin-top: 5px;
        }

        .custom-mood-input {
            margin-top: 15px;
            display: none;
        }

        .custom-mood-input.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin-top: 10px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 30px;
            display: none;
        }

        .result.show {
            display: block;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .weather-card {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
        }

        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .city-name {
            font-size: 24px;
            font-weight: 600;
        }

        .temperature {
            font-size: 48px;
            font-weight: 700;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 14px;
        }

        .quote-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            padding: 25px;
            color: #333;
        }

        .quote-text {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .quote-author {
            text-align: right;
            font-weight: 600;
            color: #666;
        }

        .quote-source {
            text-align: right;
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        .city-suggestion {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }

        .city-suggestion.show {
            display: block;
        }

        .city-suggestion-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
        }

        .city-suggestion-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .city-suggestion-btn {
            padding: 8px 15px;
            background: white;
            border: 1px solid #ffc107;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .city-suggestion-btn:hover {
            background: #ffc107;
            color: white;
        }

        .error-message {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .quote-tags {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .quote-tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* å¯åŠ¨ç”»é¢æ ·å¼ */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.8s ease-out, visibility 0.8s;
        }

        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .splash-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 50px 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: splashFadeIn 0.8s ease-out;
        }

        @keyframes splashFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .splash-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .splash-quote {
            font-size: 24px;
            line-height: 1.8;
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .splash-author {
            font-size: 16px;
            color: #666;
            font-style: italic;
        }

        .splash-timer {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        .main-content {
            /* ä¸å½±å“ä¸»ç•Œé¢æ˜¾ç¤º */
        }
    </style>
</head>
<body>
    <!-- å¯åŠ¨ç”»é¢ -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <div class="splash-icon">âœ¨</div>
            <div class="splash-quote" id="splashQuote">æ­£åœ¨åŠ è½½æ¯æ—¥å¯„è¯­...</div>
            <div class="splash-author" id="splashAuthor"></div>
        </div>
        <div class="splash-timer">æ¯æ—¥å¿ƒè¯­</div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="main-content" id="mainContent">
        <div class="container">
            <!-- å¯¼èˆªé“¾æ¥ -->
            <div style="text-align: center; margin-bottom: 20px;">
                <a href="åº·æ³¢å‘¨æœŸå¯è§†åŒ–æŠ¥å‘Š.html" style="
                    display: inline-block;
                    padding: 12px 25px;
                    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                    color: white;
                    text-decoration: none;
                    border-radius: 25px;
                    font-size: 16px;
                    font-weight: 600;
                    transition: transform 0.3s, box-shadow 0.3s;
                    box-shadow: 0 4px 15px rgba(240, 147, 251, 0.3);
                " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(240, 147, 251, 0.4)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(240, 147, 251, 0.3)'">
                    ğŸ“Š åº·æ³¢å‘¨æœŸæŠ¥å‘Š
                </a>
            </div>

            <h1>ğŸŒ¤ï¸ å¿ƒæƒ…å¤©æ°”ç«™</h1>

        <div class="form-group">
            <label for="city">è¾“å…¥æ‚¨çš„åŸå¸‚ï¼š</label>
            <input type="text" id="city" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·...">
        </div>

        <div class="form-group">
            <label>é€‰æ‹©æ‚¨çš„å¿ƒæƒ…ï¼š</label>
            <div class="mood-options">
                <button class="mood-btn" data-mood="happy">
                    ğŸ˜Š<span>å¼€å¿ƒ</span>
                </button>
                <button class="mood-btn" data-mood="sad">
                    ğŸ˜¢<span>éš¾è¿‡</span>
                </button>
                <button class="mood-btn" data-mood="anxious">
                    ğŸ˜°<span>ç„¦è™‘</span>
                </button>
                <button class="mood-btn" data-mood="tired">
                    ğŸ˜´<span>ç–²æƒ«</span>
                </button>
                <button class="mood-btn" data-mood="excited">
                    ğŸ¤©<span>å…´å¥‹</span>
                </button>
                <button class="mood-btn" data-mood="confused">
                    ğŸ˜•<span>è¿·èŒ«</span>
                </button>
                <button class="mood-btn" data-mood="custom">
                    ğŸ’­<span>å…¶ä»–</span>
                </button>
            </div>

            <div class="custom-mood-input" id="customMoodInput">
                <label for="customMood">å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„å¿ƒæƒ…ï¼š</label>
                <textarea id="customMood" placeholder="è¯´è¯´æ‚¨ç°åœ¨çš„æ„Ÿå—ï¼Œæ¯”å¦‚ï¼šä»Šå¤©å·¥ä½œå‹åŠ›å¾ˆå¤§ã€å’Œå¥½æœ‹å‹åµæ¶äº†ã€è€ƒè¯•æ²¡è€ƒå¥½..."></textarea>
            </div>
        </div>

        <button class="submit-btn" onclick="getWeatherAndQuote()">æŸ¥çœ‹å¤©æ°”</button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨è·å–å¤©æ°”ä¿¡æ¯...</p>
        </div>

        <div class="city-suggestion" id="citySuggestion">
            <div class="city-suggestion-title">ğŸ¤” æ²¡æ‰¾åˆ°è¯¥åŸå¸‚ï¼Œè¯•è¯•è¿™äº›ï¼Ÿ</div>
            <div class="city-suggestion-list" id="citySuggestionList"></div>
        </div>

        <div class="result" id="result">
            <div class="weather-card">
                <div class="weather-header">
                    <div class="city-name" id="cityName"></div>
                    <div class="temperature" id="temperature"></div>
                </div>
                <div class="weather-details">
                    <div>å¤©æ°”: <span id="weatherDesc"></span></div>
                    <div>æ¹¿åº¦: <span id="humidity"></span></div>
                    <div>é£é€Ÿ: <span id="windSpeed"></span></div>
                    <div>ä½“æ„Ÿ: <span id="feelsLike"></span></div>
                </div>
            </div>

            <div class="quote-card">
                <div class="quote-text" id="quoteText"></div>
                <div class="quote-author" id="quoteAuthor"></div>
                <div class="quote-source" id="quoteSource"></div>
            </div>
        </div>

        <div class="error-message" id="errorMessage"></div>
        </div>
    </div>

    <script>
        let selectedMood = null;
        let customMoodText = '';
        let cachedQuotes = {};
        let cachedWeather = {};
        let lastUpdateCheck = 0;
        const UPDATE_CHECK_INTERVAL = 24 * 60 * 60 * 1000; // 24å°æ—¶
        const WEATHER_CACHE_DURATION = 10 * 60 * 1000; // å¤©æ°”ç¼“å­˜10åˆ†é’Ÿ

        // ä¸»è¦åŸå¸‚åˆ—è¡¨ï¼ˆç”¨äºé¢„åŠ è½½ï¼‰
        const majorCitiesForPreload = [
            'åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·', 'æˆéƒ½', 'é‡åº†', 'æ­¦æ±‰', 'è¥¿å®‰', 'å—äº¬',
            'å¤©æ´¥', 'è‹å·', 'é•¿æ²™', 'éƒ‘å·', 'ä¸œè', 'é’å²›', 'æ²ˆé˜³', 'å®æ³¢', 'æ˜†æ˜', 'åˆè‚¥'
        ];

        // å¿ƒæƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.mood-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                selectedMood = this.dataset.mood;

                const customInput = document.getElementById('customMoodInput');
                if (selectedMood === 'custom') {
                    customInput.classList.add('show');
                } else {
                    customInput.classList.remove('show');
                }
            });
        });

        // ç›‘å¬è‡ªå®šä¹‰å¿ƒæƒ…è¾“å…¥
        document.getElementById('customMood').addEventListener('input', function(e) {
            customMoodText = e.target.value.trim();
        });

        // æ™ºèƒ½å¼€å¯¼æ•°æ®åº“
        const adviceDatabase = {
            keywords: {
                'å·¥ä½œ': "å·¥ä½œç¡®å®é‡è¦ï¼Œä½†åˆ«å¿˜äº†å·¥ä½œæ˜¯ä¸ºäº†æ›´å¥½çš„ç”Ÿæ´»ã€‚é€‚å½“ç»™è‡ªå·±æ”¾ä¸ªå‡ï¼Œå……ç”µåå†å‡ºå‘ï¼Œä½ ä¼šå‘ç°æ•ˆç‡æ›´é«˜ã€‚",
                'å­¦ä¹ ': "å­¦ä¹ æ˜¯ä¸€åœºé©¬æ‹‰æ¾ï¼Œä¸æ˜¯çŸ­è·‘ã€‚ä»Šå¤©çš„åŠªåŠ›éƒ½ä¸ä¼šç™½è´¹ï¼Œåªæ˜¯ç»“æœå¯èƒ½éœ€è¦æ—¶é—´ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œç»§ç»­å‰è¿›ï¼",
                'è€ƒè¯•': "è€ƒè¯•åªæ˜¯æ£€éªŒå­¦ä¹ çš„ä¸€ç§æ–¹å¼ï¼Œä¸èƒ½å®šä¹‰ä½ çš„å…¨éƒ¨ã€‚å°½åŠ›å°±å¥½ï¼Œç»“æœå¦‚ä½•éƒ½ä¸å½±å“ä½ æ˜¯ä¸€ä¸ªä¼˜ç§€çš„äººã€‚",
                'å‹åŠ›': "å‹åŠ›è¯´æ˜ä½ åœ¨ä¹ï¼Œä½†åˆ«è®©å‹åŠ›å‹å®äº†ä½ ã€‚è¯•ç€æŠŠå¤§ä»»åŠ¡åˆ†è§£æˆå°æ­¥éª¤ï¼Œä¸€æ­¥ä¸€æ­¥æ¥ï¼Œä½ ä¼šå‘ç°æ²¡é‚£ä¹ˆéš¾ã€‚",
                'åŠ ç­': "åŠ ç­æ˜¯æš‚æ—¶çš„ï¼Œå¥åº·æ˜¯ä¸€ç”Ÿçš„ã€‚è®°ä½ï¼Œä½ çš„ä»·å€¼ä¸åœ¨äºå·¥ä½œäº†å¤šå°‘å°æ—¶ï¼Œè€Œåœ¨äºä½ åˆ›é€ äº†ä»€ä¹ˆä»·å€¼ã€‚",
                'å¤±ä¸š': "å¤±ä¸šå¯èƒ½æ˜¯ä¸€ä¸ªè½¬æŠ˜ç‚¹ï¼Œä¹Ÿæ˜¯é‡æ–°å®¡è§†è‡ªå·±çš„æœºä¼šã€‚å¾ˆå¤šäººåœ¨å¤±å»å·¥ä½œåæ‰¾åˆ°äº†æ›´é€‚åˆè‡ªå·±çš„äººç”Ÿé“è·¯ã€‚",
                'åµæ¶': "åµæ¶æ˜¯å› ä¸ºæ²Ÿé€šä¸ç•…ï¼Œå†·é™ä¸‹æ¥åè¯•ç€ç†è§£å¯¹æ–¹çš„ç«‹åœºã€‚çŸ›ç›¾æ˜¯å…³ç³»çš„ä¸€éƒ¨åˆ†ï¼Œé‡è¦çš„æ˜¯å¦‚ä½•è§£å†³å®ƒã€‚",
                'åˆ†æ‰‹': "ç»“æŸä¸€æ®µå…³ç³»å¾ˆéš¾ï¼Œä½†æœ‰æ—¶å€™æ”¾æ‰‹ä¹Ÿæ˜¯å¯¹è‡ªå·±çš„ä¸€ç§ä¿æŠ¤ã€‚æ—¶é—´ä¼šæ²»æ„ˆä¸€åˆ‡ï¼Œä½ ä¼šé‡åˆ°æ›´é€‚åˆçš„äººã€‚",
                'å­¤ç‹¬': "å­¤ç‹¬æ„Ÿæ˜¯æ¯ä¸ªäººéƒ½ä¼šç»å†çš„ï¼Œå®ƒæé†’æˆ‘ä»¬éœ€è¦ä¸ä»–äººå»ºç«‹è¿æ¥ã€‚è¯•ç€ä¸»åŠ¨è”ç³»è€æœ‹å‹ï¼Œæˆ–è€…å‚åŠ å…´è¶£å°ç»„ã€‚",
                'æœ‹å‹': "æœ‹å‹ä¸åœ¨å¤šï¼Œåœ¨äºçœŸå¿ƒã€‚çæƒœé‚£äº›åœ¨ä½ å›°éš¾æ—¶ä¾ç„¶é™ªä¼´ä½ çš„äººï¼Œä»–ä»¬æ‰æ˜¯çœŸæ­£çš„æœ‹å‹ã€‚",
                'å®¶äºº': "å®¶äººä¹‹é—´å¯èƒ½æœ‰çŸ›ç›¾ï¼Œä½†è¡€æµ“äºæ°´ã€‚è¯•ç€ç”¨ç†è§£å’ŒåŒ…å®¹å»åŒ–è§£ï¼Œå®¶æ°¸è¿œæ˜¯ä½ æœ€æ¸©æš–çš„æ¸¯æ¹¾ã€‚",
                'éš¾è¿‡': "éš¾è¿‡çš„æ—¶å€™å…è®¸è‡ªå·±å“­å‡ºæ¥ï¼Œè¿™æ˜¯æƒ…ç»ªçš„è‡ªç„¶æµéœ²ã€‚å“­å®Œä¹‹åï¼Œè®°å¾—æ“¦å¹²çœ¼æ³ªï¼Œç»§ç»­å‰è¡Œã€‚",
                'ç”Ÿæ°”': "ç”Ÿæ°”æ˜¯å¯ä»¥çš„ï¼Œä½†åˆ«è®©æ„¤æ€’æ§åˆ¶ä½ çš„è¡Œä¸ºã€‚æ·±å‘¼å¸ï¼Œæ•°åˆ°åï¼Œå†åšå†³å®šã€‚ä¸è¦åœ¨æ°”å¤´ä¸Šè¯´åæ‚”çš„è¯ã€‚",
                'å¤±æœ›': "å¤±æœ›æºäºæœŸæœ›ï¼Œä¹Ÿè®¸æ˜¯æ—¶å€™è°ƒæ•´æœŸæœ›äº†ã€‚ä¸æ˜¯æ¯ä»¶äº‹éƒ½ä¼šæŒ‰è®¡åˆ’è¿›è¡Œï¼Œå­¦ä¼šæ¥å—ä¸å®Œç¾ä¹Ÿæ˜¯æˆé•¿ã€‚",
                'å®³æ€•': "å®³æ€•è¯´æ˜ä½ åœ¨ä¹ï¼Œä½†ä¸è¦è®©ææƒ§é˜»æ­¢ä½ å°è¯•ã€‚æœ€å›°éš¾çš„æ˜¯ç¬¬ä¸€æ­¥ï¼Œè·¨è¿‡å»åä½ ä¼šå‘ç°æ²¡é‚£ä¹ˆå¯æ€•ã€‚",
                'è‡ªå‘': "æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„é—ªå…‰ç‚¹ï¼Œä¹Ÿè®¸ä½ è¿˜æ²¡å‘ç°ã€‚åˆ«æ€»æ‹¿è‡ªå·±çš„çŸ­å¤„å’Œåˆ«äººçš„é•¿å¤„æ¯”ï¼Œä½ æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚",
                'å¤±è´¥': "å¤±è´¥ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯æˆåŠŸçš„å«è„šçŸ³ã€‚æ¯æ¬¡å¤±è´¥éƒ½è®©ä½ ç¦»æˆåŠŸæ›´è¿‘ä¸€æ­¥ï¼Œåªè¦ä½ ä¸æ”¾å¼ƒã€‚",
                'åæ‚”': "åæ‚”æ”¹å˜ä¸äº†è¿‡å»ï¼Œä½†å¯ä»¥å½±å“æœªæ¥ã€‚ä»é”™è¯¯ä¸­å­¦ä¹ ï¼Œç„¶åæ”¾è¿‡è‡ªå·±ï¼Œç»§ç»­å‰è¿›ã€‚",
                'è¿·èŒ«': "è¿·èŒ«æ—¶åˆ«æ€¥ç€åšå†³å®šï¼Œç»™è‡ªå·±ä¸€äº›æ—¶é—´ã€‚å¤šå°è¯•ä¸åŒçš„äº‹ç‰©ï¼Œç­”æ¡ˆä¼šåœ¨è¡ŒåŠ¨ä¸­é€æ¸æ¸…æ™°ã€‚"
            },
            default: [
                "ä¸ç®¡ä½ ç°åœ¨ç»å†äº†ä»€ä¹ˆï¼Œè®°ä½ï¼šè¿™ä¸ªéš¾å…³åªæ˜¯æš‚æ—¶çš„ï¼Œä½ ä¼šè¿‡å»çš„ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ¯”æƒ³è±¡ä¸­æ›´åšå¼ºã€‚",
                "ç”Ÿæ´»ä¸­æ€»ä¼šæœ‰èµ·èµ·è½è½ï¼Œè¿™æ˜¯å¸¸æ€ã€‚é‡è¦çš„æ˜¯åœ¨ä½è°·æ—¶ä¸è¦æ”¾å¼ƒï¼Œå› ä¸ºä¸‹ä¸€ä¸ªè½¬è§’å¯èƒ½å°±æ˜¯ä¸Šå¡è·¯ã€‚",
                "æ¯ä¸ªäººéƒ½æœ‰ä½è°·æœŸï¼Œè¿™ä¸ä»£è¡¨ä½ ä¸å¤Ÿå¥½ã€‚ç»™è‡ªå·±ä¸€äº›æ—¶é—´å’Œè€å¿ƒï¼Œé˜³å…‰æ€»åœ¨é£é›¨åã€‚",
                "ä½ ç°åœ¨å¯èƒ½è§‰å¾—å¾ˆç´¯ã€å¾ˆéš¾ï¼Œä½†è¿™äº›æ„Ÿå—éƒ½æ˜¯æš‚æ—¶çš„ã€‚ç¡ä¸ªå¥½è§‰ï¼Œæ˜å¤©åˆæ˜¯æ–°çš„ä¸€å¤©ã€‚",
                "è®°ä½ï¼Œä½ ä¸éœ€è¦æ—¶åˆ»ä¿æŒåšå¼ºã€‚è„†å¼±ä¹Ÿæ²¡å…³ç³»ï¼Œç´¯äº†å°±ä¼‘æ¯ï¼Œéš¾è¿‡äº†å°±å“­å‡ºæ¥ã€‚æ˜å¤©å¤ªé˜³ä¾ç„¶ä¼šå‡èµ·ã€‚"
            ]
        };

        function generateCustomAdvice(userInput) {
            const input = userInput.toLowerCase();
            for (const [keyword, advice] of Object.entries(adviceDatabase.keywords)) {
                if (input.includes(keyword)) {
                    return { text: advice, author: "ç»™ä½ çš„å»ºè®®", source: "æœ¬åœ°æ™ºèƒ½å¼€å¯¼" };
                }
            }
            const randomIndex = Math.floor(Math.random() * adviceDatabase.default.length);
            return { text: adviceDatabase.default[randomIndex], author: "ç»™ä½ çš„å»ºè®®", source: "æœ¬åœ°æ™ºèƒ½å¼€å¯¼" };
        }

        // åœ¨çº¿APIè·å–å¯„è¯­ï¼ˆä¼˜åŒ–ç‰ˆï¼Œå¸¦è¶…æ—¶ï¼‰
        async function fetchOnlineQuote(mood) {
            try {
                // ä½¿ç”¨ Quotable API (å…è´¹ï¼Œæ— éœ€API key)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3ç§’è¶…æ—¶

                const response = await fetch('https://api.quotable.io/quotes/random?limit=1&tags=' + getQuoteTag(mood), {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    },
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    if (data && data_quotes && data_quotes.length > 0) {
                        const quote = data_quotes[0];
                        return {
                            text: quote.content,
                            author: quote.author || "",
                            source: "Quotable API"
                        };
                    }
                }
                throw new Error('APIè¿”å›ä¸ºç©º');
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('åœ¨çº¿APIè¯·æ±‚è¶…æ—¶ï¼Œä½¿ç”¨æœ¬åœ°è¯­åº“');
                } else {
                    console.log('åœ¨çº¿APIè·å–å¤±è´¥:', error.message);
                }
                return null;
            }
        }

        // æ ¹æ®å¿ƒæƒ…è·å–å¯¹åº”çš„æ ‡ç­¾
        function getQuoteTag(mood) {
            const tagMap = {
                'happy': 'wisdom,happiness',
                'sad': 'hope,faith',
                'anxious': 'courage,determination',
                'tired': 'motivation,perseverance',
                'excited': 'ambition,success',
                'confused': 'wisdom,truth',
                'daily': 'inspirational'
            };
            return tagMap[mood] || 'inspirational';
        }

        // è·å–æ¯æ—¥å¯„è¯­ï¼ˆç»“åˆåœ¨çº¿APIï¼‰
        async function getDailyQuote() {
            const today = new Date().toDateString();

            // æ£€æŸ¥ç¼“å­˜
            if (cachedQuotes['daily'] && cachedQuotes['daily'].date === today) {
                return cachedQuotes['daily'].quote;
            }

            // å°è¯•ä»åœ¨çº¿APIè·å–
            const onlineQuote = await fetchOnlineQuote('daily');
            if (onlineQuote) {
                cachedQuotes['daily'] = {
                    quote: onlineQuote,
                    date: today
                };
                return onlineQuote;
            }

            // å¤‡ç”¨ï¼šä½¿ç”¨æœ¬åœ°æ¯æ—¥å¯„è¯­
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const dailyQuotes = [
                { text: "æ¯ä¸€å¤©éƒ½æ˜¯ä¸€ä¸ªæ–°çš„æœºä¼šï¼ŒæŠŠæ¡ä»Šå¤©å°±èƒ½åˆ›é€ ç¾å¥½çš„æ˜å¤©ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "ä¸å…¶æ‹…å¿ƒæœªæ¥ï¼Œä¸å¦‚ä¸“æ³¨å½“ä¸‹ï¼Œåšå¥½æ‰‹å¤´çš„äº‹ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "ç›¸ä¿¡è‡ªå·±ï¼Œä½ å·²ç»æ¯”æ˜¨å¤©æ›´å¼ºå¤§äº†ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "ç”Ÿæ´»ä¸æ˜¯ç­‰å¾…æš´é£é›¨è¿‡å»ï¼Œè€Œæ˜¯å­¦ä¼šåœ¨é›¨ä¸­è·³èˆã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "å³ä½¿èµ°å¾—æ…¢ï¼Œåªè¦åšæŒå‘å‰ï¼Œç»ˆç©¶ä¼šåˆ°è¾¾ç›®çš„åœ°ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "ä»Šå¤©çš„åŠªåŠ›æ˜¯æ˜å¤©çš„æ”¶è·ï¼Œç»§ç»­åŠ æ²¹ï¼", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "å¾®ç¬‘é¢å¯¹æ¯ä¸€å¤©ï¼Œå¥½è¿è‡ªç„¶ä¼šæ¥æ•²é—¨ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" }
            ];

            const quote = dailyQuotes[dayOfYear % dailyQuotes.length];
            cachedQuotes['daily'] = {
                quote: quote,
                date: today
            };
            return quote;
        }

        // è·å–æŒ‡å®šå¿ƒæƒ…çš„å¯„è¯­ï¼ˆéšæœºåŒ–ï¼‰
        async function getQuoteByMood(mood) {
            // ä¼˜å…ˆå°è¯•åœ¨çº¿APIï¼ˆå¸¦éšæœºæ€§ï¼‰
            const onlineQuote = await fetchOnlineQuote(mood);
            if (onlineQuote) {
                // åœ¨çº¿APIæœ¬èº«å°±è¿”å›éšæœºå¯„è¯­
                return onlineQuote;
            }

            // å¤‡ç”¨ï¼šä½¿ç”¨æœ¬åœ°è¯­åº“ï¼ˆéšæœºé€‰æ‹©ï¼‰
            const localQuotes = {
                happy: [
                    { text: "å¿«ä¹ä¸æ˜¯å› ä¸ºæ‹¥æœ‰çš„å¤šï¼Œè€Œæ˜¯å› ä¸ºè®¡è¾ƒçš„å°‘ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ç”Ÿå‘½ä¸­æœ€å¤§çš„å¿«ä¹æ˜¯ç¡®ä¿¡æœ‰äººçˆ±ç€æˆ‘ä»¬ã€‚", author: "é›¨æœ", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ä¿æŒå¿«ä¹ï¼Œä½ ä¼šå‘ç°ä¸–ç•Œä¹Ÿåœ¨å¯¹ä½ å¾®ç¬‘ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "å¿«ä¹æ˜¯ä¸€ç§é€‰æ‹©ï¼Œé€‰æ‹©å¾®ç¬‘ï¼Œä¸–ç•Œä¼šå› ä½ è€Œç¾å¥½ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "å¿«ä¹å°±åœ¨å½“ä¸‹ï¼Œçæƒœçœ¼å‰çš„ç¾å¥½æ—¶å…‰ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                sad: [
                    { text: "å³ä½¿æœ€è‰°éš¾çš„æ—¥å­ï¼Œä¹Ÿä¼šè¿‡å»ã€‚å¤ªé˜³ä¼šå†æ¬¡å‡èµ·ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ¯ä¸€ä¸ªä¸æ›¾èµ·èˆçš„æ—¥å­ï¼Œéƒ½æ˜¯å¯¹ç”Ÿå‘½çš„è¾œè´Ÿã€‚", author: "å°¼é‡‡", source: "æœ¬åœ°è¯­åº“" },
                    { text: "çœ¼æ³ªæ˜¯å¿ƒçµçš„æ¸…æ´å‰‚ï¼Œè®©å®ƒæµï¼Œç„¶åç»§ç»­å‰è¡Œã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "å›°éš¾æ˜¯æˆé•¿çš„é˜¶æ¢¯ï¼Œå‹‡æ•¢åœ°è·¨è¿‡å»ï¼Œä½ ä¼šæ›´å¼ºå¤§ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ä»Šæ™šçš„æ³ªæ°´ä¼šæˆä¸ºæ˜å¤©çš„åŠ›é‡ï¼ŒåŠ æ²¹ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                anxious: [
                    { text: "ä¸è¦é¢„æ”¯æ˜å¤©çš„çƒ¦æ¼ï¼Œä»Šå¤©å·²ç»å¤Ÿå¿™äº†ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚", author: "è€å­", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ç„¦è™‘ä¸ä¼šæ¶ˆé™¤æ˜å¤©çš„æ‚²ä¼¤ï¼Œåªä¼šæ¶ˆå‡ä»Šå¤©çš„åŠ›é‡ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ·±å‘¼å¸ï¼Œæ”¾æ¾å¿ƒæƒ…ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ‹…å¿ƒä¸ä¼šæ”¹å˜ç»“æœï¼Œä½†è¡ŒåŠ¨ä¼šã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                tired: [
                    { text: "ä¼‘æ¯ä¸æ˜¯æ”¾å¼ƒï¼Œè€Œæ˜¯ä¸ºäº†æ›´å¥½åœ°å‡ºå‘ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "äººç”Ÿå°±åƒé©¬æ‹‰æ¾ï¼Œé‡è¦çš„ä¸æ˜¯é€Ÿåº¦ï¼Œè€Œæ˜¯åšæŒã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ç´¯çš„æ—¶å€™ï¼Œå…è®¸è‡ªå·±åœä¸‹æ¥ï¼Œé˜³å…‰ä¾ç„¶ä¼šç…§åœ¨ä½ èº«ä¸Šã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "é€‚å½“ä¼‘æ¯ä¸æ˜¯å·æ‡’ï¼Œè€Œæ˜¯ä¸ºäº†èµ°å¾—æ›´è¿œã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "èº«ä½“ç´¯äº†å°±ä¼‘æ¯ï¼Œå¿ƒç´¯äº†å°±æ”¾ä¸‹ï¼Œæ˜å¤©åˆæ˜¯æ–°çš„å¼€å§‹ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                excited: [
                    { text: "ä¿æŒè¿™ä»½çƒ­æƒ…ï¼Œå®ƒå°†å¸¦ä½ å»å¾€æ¢¦æƒ³çš„å½¼å²¸ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ¿€æƒ…æ˜¯æˆåŠŸçš„ç‡ƒæ–™ï¼Œè®©å®ƒç‡ƒçƒ§å¾—æ›´çŒ›çƒˆäº›å§ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ¯ä¸€ä¸ªä¼Ÿå¤§çš„æˆå°±ï¼Œéƒ½å§‹äºä¸€ä»½æ¿€æƒ…ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "å°†è¿™ä»½å…´å¥‹è½¬åŒ–ä¸ºè¡ŒåŠ¨ï¼Œåˆ›é€ å±äºä½ çš„ç²¾å½©ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ­¤åˆ»çš„æ¿€æƒ…æ˜¯ä½ æˆåŠŸçš„ç§å­ï¼Œå¥½å¥½åŸ¹è‚²å®ƒã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                confused: [
                    { text: "è¿·èŒ«çš„æ—¶å€™ï¼Œé™ä¸‹å¿ƒæ¥ï¼Œç­”æ¡ˆå°±åœ¨ä½ å¿ƒä¸­ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "è·¯æ˜¯èµ°å‡ºæ¥çš„ï¼Œä¸æ˜¯æƒ³å‡ºæ¥çš„ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿·é›¾ä¸­æ‰èƒ½æ‰¾åˆ°çœŸæ­£çš„æ–¹å‘ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "è¿·èŒ«å¹¶ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯åœæ»ä¸å‰ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ä¸å…¶åœ¨è¿·èŒ«ä¸­å¾˜å¾Šï¼Œä¸å¦‚åœ¨è¡ŒåŠ¨ä¸­å¯»æ‰¾ç­”æ¡ˆã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ]
            };

            const quotes = localQuotes[mood] || localQuotes['happy'];
            // ä½¿ç”¨å½“å‰æ—¶é—´æˆ³ä½œä¸ºéšæœºç§å­ï¼Œç¡®ä¿æ¯æ¬¡éƒ½ä¸åŒ
            const randomIndex = Math.floor(Math.random() * quotes.length);
            return quotes[randomIndex];
        }

        // ä¸»è¦åŸå¸‚åˆ—è¡¨ï¼ˆç”¨äºåŸå¸‚å»ºè®®ï¼‰
        const majorCities = [
            // ä¸­å›½ä¸»è¦åŸå¸‚
            'åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·', 'æˆéƒ½', 'é‡åº†', 'æ­¦æ±‰', 'è¥¿å®‰', 'å—äº¬',
            'å¤©æ´¥', 'è‹å·', 'é•¿æ²™', 'éƒ‘å·', 'ä¸œè', 'é’å²›', 'æ²ˆé˜³', 'å®æ³¢', 'æ˜†æ˜', 'åˆè‚¥',
            'ç¦å·', 'å¦é—¨', 'å“ˆå°”æ»¨', 'æµå—', 'å¤§è¿', 'é•¿æ˜¥', 'å¤ªåŸ', 'è´µé˜³', 'å—æ˜Œ', 'å—å®',
            'çŸ³å®¶åº„', 'å…°å·', 'ä¹Œé²æœ¨é½', 'å‘¼å’Œæµ©ç‰¹', 'æµ·å£', 'é“¶å·', 'è¥¿å®', 'æ‹‰è¨', 'å°åŒ—',
            'é¦™æ¸¯', 'æ¾³é—¨',
            // äºšæ´²ä¸»è¦åŸå¸‚
            'ä¸œäº¬', 'é¦–å°”', 'æ›¼è°·', 'æ–°åŠ å¡', 'å‰éš†å¡', 'é›…åŠ è¾¾', 'é©¬å°¼æ‹‰', 'æ²³å†…', 'æ–°å¾·é‡Œ',
            // æ¬§æ´²ä¸»è¦åŸå¸‚
            'ä¼¦æ•¦', 'å·´é»', 'æŸæ—', 'ç½—é©¬', 'é©¬å¾·é‡Œ', 'é˜¿å§†æ–¯ç‰¹ä¸¹', 'ç»´ä¹Ÿçº³', 'è«æ–¯ç§‘',
            // åŒ—ç¾æ´²ä¸»è¦åŸå¸‚
            'çº½çº¦', 'æ´›æ‰çŸ¶', 'èŠåŠ å“¥', 'å¤šä¼¦å¤š', 'æ¸©å“¥å', 'å¢¨è¥¿å“¥åŸ',
            // å…¶ä»–
            'æ‚‰å°¼', 'å¢¨å°”æœ¬', 'è¿ªæ‹œ', 'å¼€ç½—'
        ];

        function findSimilarCities(input) {
            const inputLower = input.toLowerCase();
            const similarities = majorCities.map(city => {
                let score = 0;
                const cityLower = city.toLowerCase();
                if (cityLower.includes(inputLower) || inputLower.includes(cityLower)) {
                    score = 3;
                } else if (inputLower.length > 0 && cityLower.includes(inputLower[0])) {
                    score = 1;
                }
                return { city, score };
            }).filter(item => item.score > 0)
              .sort((a, b) => b.score - a.score)
              .slice(0, 6)
              .map(item => item.city);
            return similarities;
        }

        async function getWeatherAndQuote() {
            const city = document.getElementById('city').value.trim();
            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('errorMessage');
            const citySuggestion = document.getElementById('citySuggestion');

            resultDiv.classList.remove('show');
            errorDiv.classList.remove('show');
            citySuggestion.classList.remove('show');

            if (!city) {
                showError('è¯·è¾“å…¥åŸå¸‚åç§°');
                return;
            }

            if (!selectedMood) {
                showError('è¯·é€‰æ‹©æ‚¨çš„å¿ƒæƒ…');
                return;
            }

            if (selectedMood === 'custom' && !customMoodText) {
                showError('è¯·å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„å¿ƒæƒ…');
                return;
            }

            loadingDiv.classList.add('show');

            try {
                let weatherData = null;
                let displayCity = city;
                let nearestCityInfo = null;

                // é¦–å…ˆå°è¯•ç›´æ¥ä»æ•°æ®åº“è·å–å¤©æ°”
                weatherData = await getWeatherData(city);

                // å¦‚æœæ•°æ®åº“ä¸­æ²¡æœ‰è¯¥åŸå¸‚ï¼Œå°è¯•é€šè¿‡åœ°ç†ç¼–ç APIè·å–åæ ‡
                if (!weatherData) {
                    console.log('å°è¯•é€šè¿‡åœ°ç†ç¼–ç APIæŸ¥æ‰¾åŸå¸‚:', city);
                    const geoCoords = await getCityCoordinates(city);

                    if (geoCoords) {
                        console.log('æ‰¾åˆ°åŸå¸‚åæ ‡:', geoCoords);
                        // æ‰¾åˆ°è·ç¦»è¯¥åŸå¸‚æœ€è¿‘çš„æ•°æ®åº“ä¸­çš„åŸå¸‚
                        nearestCityInfo = findNearestCity(geoCoords.lat, geoCoords.lon);
                        console.log('æœ€è¿‘åŸå¸‚:', nearestCityInfo);

                        if (nearestCityInfo) {
                            // è·å–æœ€è¿‘åŸå¸‚çš„å¤©æ°”æ•°æ®
                            weatherData = await getWeatherData(nearestCityInfo.name);
                            if (weatherData) {
                                weatherData.actualCity = nearestCityInfo.name;
                                weatherData.isNearestCity = true;
                                weatherData.distance = nearestCityInfo.distance;
                                weatherData.inputCity = city;
                            }
                        }
                    }
                }

                // å¹¶è¡Œè¯·æ±‚ï¼šå¤©æ°”å’Œå¯„è¯­åŒæ—¶è·å–
                const quotePromise = getQuoteData(selectedMood, customMoodText);
                const quote = await quotePromise;

                // æ£€æŸ¥å¤©æ°”æ•°æ®
                if (!weatherData) {
                    loadingDiv.classList.remove('show');
                    const similarCities = findSimilarCities(city);
                    if (similarCities.length > 0) {
                        showCitySuggestions(similarCities);
                    } else {
                        showError('æ— æ³•è·å–å¤©æ°”ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥åŸå¸‚åç§°æ˜¯å¦æ­£ç¡®');
                    }
                    return;
                }

                // æ˜¾ç¤ºåŸå¸‚åç§°ï¼ˆå¦‚æœæ˜¯æœ€è¿‘åŸå¸‚ï¼Œæ˜¾ç¤ºæç¤ºï¼‰
                if (weatherData.isNearestCity) {
                    const distanceText = weatherData.distance < 1 ?
                        `${Math.round(weatherData.distance * 1000)}ç±³` :
                        `${Math.round(weatherData.distance)}å…¬é‡Œ`;
                    document.getElementById('cityName').textContent =
                        `${weatherData.inputCity} (æ˜¾ç¤º${weatherData.actualCity}å¤©æ°”, è·ç¦»${distanceText})`;
                } else {
                    document.getElementById('cityName').textContent = displayCity;
                }

                document.getElementById('temperature').textContent = `${weatherData.temp_C}Â°C`;
                document.getElementById('weatherDesc').textContent = weatherData.weatherDesc;
                document.getElementById('humidity').textContent = `${weatherData.humidity}%`;
                document.getElementById('windSpeed').textContent = `${weatherData.windSpeed} km/h`;
                document.getElementById('feelsLike').textContent = `${weatherData.feelsLike}Â°C`;

                // æ˜¾ç¤ºå¯„è¯­
                document.getElementById('quoteText').textContent = `"${quote.text}"`;

                const authorElement = document.getElementById('quoteAuthor');
                if (quote.author) {
                    authorElement.textContent = `â€”â€” ${quote.author}`;
                    authorElement.style.display = 'block';
                } else {
                    authorElement.style.display = 'none';
                }

                const sourceElement = document.getElementById('quoteSource');
                sourceElement.textContent = `æ¥æº: ${quote.source}`;
                sourceElement.style.display = 'block';

                loadingDiv.classList.remove('show');
                resultDiv.classList.add('show');

            } catch (error) {
                loadingDiv.classList.remove('show');
                const similarCities = findSimilarCities(city);
                if (similarCities.length > 0) {
                    showCitySuggestions(similarCities);
                } else {
                    showError(error.message || 'è·å–ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            }
        }

        // åŸå¸‚åç§°åˆ°ç»çº¬åº¦çš„æ˜ å°„ï¼ˆä¸­å›½åœ°çº§å¸‚ä»¥ä¸Š + ä¸–ç•Œå„å›½é¦–éƒ½åŠä¸»è¦åŸå¸‚ï¼‰
        const cityCoordinates = {
            // ç›´è¾–å¸‚
            'åŒ—äº¬': { lat: 39.9042, lon: 116.4074 },
            'ä¸Šæµ·': { lat: 31.2304, lon: 121.4737 },
            'å¤©æ´¥': { lat: 39.0842, lon: 117.2010 },
            'é‡åº†': { lat: 29.4316, lon: 106.9123 },

            // çœä¼šåŸå¸‚
            'å¹¿å·': { lat: 23.1291, lon: 113.2644 },
            'æ·±åœ³': { lat: 22.5431, lon: 114.0579 },
            'æ­å·': { lat: 30.2741, lon: 120.1551 },
            'æˆéƒ½': { lat: 30.5728, lon: 104.0668 },
            'æ­¦æ±‰': { lat: 30.5928, lon: 114.3055 },
            'è¥¿å®‰': { lat: 34.3416, lon: 108.9398 },
            'å—äº¬': { lat: 32.0603, lon: 118.7969 },
            'è‹å·': { lat: 31.2989, lon: 120.5853 },
            'é•¿æ²™': { lat: 28.2282, lon: 112.9388 },
            'éƒ‘å·': { lat: 34.7466, lon: 113.6253 },
            'ä¸œè': { lat: 23.0430, lon: 113.7633 },
            'é’å²›': { lat: 36.0671, lon: 120.3826 },
            'æ²ˆé˜³': { lat: 41.8057, lon: 123.4315 },
            'å®æ³¢': { lat: 29.8683, lon: 121.5440 },
            'æ˜†æ˜': { lat: 25.0389, lon: 102.7183 },
            'åˆè‚¥': { lat: 31.8206, lon: 117.2272 },
            'ç¦å·': { lat: 26.0745, lon: 119.2965 },
            'å¦é—¨': { lat: 24.4798, lon: 118.0819 },
            'å“ˆå°”æ»¨': { lat: 45.8038, lon: 126.5340 },
            'æµå—': { lat: 36.6512, lon: 117.1201 },
            'å¤§è¿': { lat: 38.9140, lon: 121.6147 },
            'é•¿æ˜¥': { lat: 43.8171, lon: 125.3235 },
            'å¤ªåŸ': { lat: 37.8706, lon: 112.5489 },
            'è´µé˜³': { lat: 26.6470, lon: 106.6302 },
            'å—æ˜Œ': { lat: 28.6820, lon: 115.8579 },
            'å—å®': { lat: 22.8170, lon: 108.3661 },
            'çŸ³å®¶åº„': { lat: 38.0428, lon: 114.5149 },
            'å…°å·': { lat: 36.0611, lon: 103.8343 },
            'ä¹Œé²æœ¨é½': { lat: 43.8256, lon: 87.6168 },
            'å‘¼å’Œæµ©ç‰¹': { lat: 40.8414, lon: 111.7519 },
            'æµ·å£': { lat: 20.0444, lon: 110.1999 },
            'é“¶å·': { lat: 38.4681, lon: 106.2731 },
            'è¥¿å®': { lat: 36.6171, lon: 101.7782 },
            'æ‹‰è¨': { lat: 29.6500, lon: 91.1000 },

            // å¹¿ä¸œçœåœ°çº§å¸‚
            'ç æµ·': { lat: 22.2769, lon: 113.5678 },
            'ä½›å±±': { lat: 23.0218, lon: 113.1214 },
            'æƒ å·': { lat: 23.1115, lon: 114.4152 },
            'ä¸­å±±': { lat: 22.5171, lon: 113.3926 },
            'æ±Ÿé—¨': { lat: 22.5789, lon: 113.0819 },
            'è‚‡åº†': { lat: 23.0469, lon: 112.4654 },
            'æ¹›æ±Ÿ': { lat: 21.2707, lon: 110.3594 },
            'èŒ‚å': { lat: 21.6629, lon: 110.9252 },
            'æ±•å¤´': { lat: 23.3536, lon: 116.6819 },
            'æ½®å·': { lat: 23.6566, lon: 116.6227 },
            'æ­é˜³': { lat: 23.5499, lon: 116.3728 },
            'æ±•å°¾': { lat: 22.7862, lon: 115.3753 },
            'éŸ¶å…³': { lat: 24.8108, lon: 113.5975 },
            'æ¸…è¿œ': { lat: 23.6820, lon: 113.0560 },
            'äº‘æµ®': { lat: 22.9150, lon: 112.0444 },
            'é˜³æ±Ÿ': { lat: 21.8576, lon: 111.9823 },
            'æ²³æº': { lat: 23.7433, lon: 114.6974 },
            'æ¢…å·': { lat: 24.2888, lon: 116.1175 },

            // æ±Ÿè‹çœåœ°çº§å¸‚
            'æ— é”¡': { lat: 31.4912, lon: 120.3119 },
            'å¸¸å·': { lat: 31.8106, lon: 119.9741 },
            'å—é€š': { lat: 31.9807, lon: 120.8946 },
            'æ³°å·': { lat: 32.4554, lon: 119.9231 },
            'æ‰¬å·': { lat: 32.3949, lon: 119.4128 },
            'é•‡æ±Ÿ': { lat: 32.1880, lon: 119.4550 },
            'å¾å·': { lat: 34.2044, lon: 117.2844 },
            'è¿äº‘æ¸¯': { lat: 34.5966, lon: 119.2216 },
            'ç›åŸ': { lat: 33.3477, lon: 120.1617 },
            'æ·®å®‰': { lat: 33.5904, lon: 119.0153 },
            'å®¿è¿': { lat: 33.9630, lon: 118.2757 },

            // æµ™æ±Ÿçœåœ°çº§å¸‚
            'æ¸©å·': { lat: 28.0000, lon: 120.6667 },
            'å˜‰å…´': { lat: 30.7527, lon: 120.7590 },
            'æ¹–å·': { lat: 30.8936, lon: 120.0880 },
            'ç»å…´': { lat: 30.0299, lon: 120.5802 },
            'é‡‘å': { lat: 29.0787, lon: 119.6479 },
            'è¡¢å·': { lat: 28.9358, lon: 118.8597 },
            'èˆŸå±±': { lat: 29.9853, lon: 122.2072 },
            'å°å·': { lat: 28.6563, lon: 121.4288 },
            'ä¸½æ°´': { lat: 28.4675, lon: 119.9229 },

            // å±±ä¸œçœåœ°çº§å¸‚
            'çƒŸå°': { lat: 37.4638, lon: 121.4479 },
            'æ½åŠ': { lat: 36.7069, lon: 119.1619 },
            'æ·„åš': { lat: 36.8131, lon: 118.0548 },
            'æµå®': { lat: 35.4154, lon: 116.5871 },
            'æ³°å®‰': { lat: 36.2003, lon: 117.0874 },
            'å¨æµ·': { lat: 37.5131, lon: 122.1200 },
            'æ—¥ç…§': { lat: 35.4164, lon: 119.5269 },
            'ä¸´æ²‚': { lat: 35.1041, lon: 118.3561 },
            'å¾·å·': { lat: 37.4355, lon: 116.3595 },
            'èŠåŸ': { lat: 36.4559, lon: 115.9853 },
            'æ»¨å·': { lat: 37.3835, lon: 117.9708 },
            'èæ³½': { lat: 35.2333, lon: 115.4807 },
            'æ£åº„': { lat: 34.8107, lon: 117.3234 },
            'ä¸œè¥': { lat: 37.4347, lon: 118.6752 },

            // å››å·çœåœ°çº§å¸‚
            'ç»µé˜³': { lat: 31.4678, lon: 104.6794 },
            'è‡ªè´¡': { lat: 29.3393, lon: 104.7784 },
            'æ”€æèŠ±': { lat: 26.5823, lon: 101.7189 },
            'æ³¸å·': { lat: 28.8719, lon: 105.4420 },
            'å¾·é˜³': { lat: 31.1311, lon: 104.3981 },
            'å¹¿å…ƒ': { lat: 32.4354, lon: 105.8431 },
            'é‚å®': { lat: 30.5133, lon: 105.5929 },
            'å†…æ±Ÿ': { lat: 29.5833, lon: 105.0583 },
            'ä¹å±±': { lat: 29.5520, lon: 103.7656 },
            'å—å……': { lat: 30.8373, lon: 106.1106 },
            'çœ‰å±±': { lat: 30.0492, lon: 103.8486 },
            'å®œå®¾': { lat: 28.7521, lon: 104.6430 },
            'å¹¿å®‰': { lat: 30.4673, lon: 106.6333 },
            'è¾¾å·': { lat: 31.2093, lon: 107.4680 },
            'é›…å®‰': { lat: 30.0105, lon: 103.0013 },
            'å·´ä¸­': { lat: 31.8691, lon: 106.7477 },
            'èµ„é˜³': { lat: 30.1289, lon: 104.6418 },
            'é˜¿å': { lat: 31.8992, lon: 102.2214 },
            'ç”˜å­œ': { lat: 31.6229, lon: 100.0031 },
            'å‡‰å±±': { lat: 27.8817, lon: 102.2679 },

            // æ¹–åŒ—çœåœ°çº§å¸‚
            'è¥„é˜³': { lat: 32.0090, lon: 112.1225 },
            'å®œæ˜Œ': { lat: 30.6918, lon: 111.2867 },
            'é»„çŸ³': { lat: 30.2004, lon: 115.0389 },
            'åå °': { lat: 32.6475, lon: 110.7987 },
            'è†å·': { lat: 30.3352, lon: 112.2410 },
            'è†é—¨': { lat: 31.0354, lon: 112.1992 },
            'é„‚å·': { lat: 30.3915, lon: 114.8950 },
            'å­æ„Ÿ': { lat: 30.9243, lon: 113.9169 },
            'é»„å†ˆ': { lat: 30.4461, lon: 114.8720 },
            'å’¸å®': { lat: 29.8329, lon: 114.3224 },
            'éšå·': { lat: 31.6903, lon: 113.3826 },
            'æ©æ–½': { lat: 30.2722, lon: 109.4879 },

            // æ¹–å—çœåœ°çº§å¸‚
            'æ ªæ´²': { lat: 27.8274, lon: 113.1337 },
            'æ¹˜æ½­': { lat: 27.8298, lon: 112.9447 },
            'è¡¡é˜³': { lat: 26.8968, lon: 112.5718 },
            'é‚µé˜³': { lat: 27.2368, lon: 111.4674 },
            'å²³é˜³': { lat: 29.3572, lon: 113.0967 },
            'å¸¸å¾·': { lat: 29.0318, lon: 111.6983 },
            'å¼ å®¶ç•Œ': { lat: 29.1170, lon: 110.4791 },
            'ç›Šé˜³': { lat: 28.5539, lon: 112.3550 },
            'éƒ´å·': { lat: 25.7705, lon: 113.0149 },
            'æ°¸å·': { lat: 26.4206, lon: 111.6133 },
            'æ€€åŒ–': { lat: 27.5698, lon: 109.9783 },
            'å¨„åº•': { lat: 27.6994, lon: 111.9945 },
            'æ¹˜è¥¿': { lat: 28.3117, lon: 109.7397 },

            // æ²³å—çœåœ°çº§å¸‚
            'å¼€å°': { lat: 34.7971, lon: 114.3075 },
            'æ´›é˜³': { lat: 34.6196, lon: 112.4540 },
            'å¹³é¡¶å±±': { lat: 33.7661, lon: 113.1925 },
            'å®‰é˜³': { lat: 36.0979, lon: 114.3927 },
            'é¹¤å£': { lat: 35.7478, lon: 114.2971 },
            'æ–°ä¹¡': { lat: 35.3029, lon: 113.9268 },
            'ç„¦ä½œ': { lat: 35.2159, lon: 113.2420 },
            'æ¿®é˜³': { lat: 35.7625, lon: 115.0296 },
            'è®¸æ˜Œ': { lat: 34.0357, lon: 113.8523 },
            'æ¼¯æ²³': { lat: 33.5817, lon: 114.0461 },
            'ä¸‰é—¨å³¡': { lat: 34.7733, lon: 111.2001 },
            'å—é˜³': { lat: 32.9908, lon: 112.5282 },
            'å•†ä¸˜': { lat: 34.4144, lon: 115.6506 },
            'ä¿¡é˜³': { lat: 32.1285, lon: 114.0913 },
            'å‘¨å£': { lat: 33.6265, lon: 114.6965 },
            'é©»é©¬åº—': { lat: 32.9803, lon: 114.0223 },
            'æµæº': { lat: 35.0670, lon: 112.6017 },

            // æ²³åŒ—çœåœ°çº§å¸‚
            'å”å±±': { lat: 39.6292, lon: 118.1746 },
            'ç§¦çš‡å²›': { lat: 39.9354, lon: 119.5996 },
            'é‚¯éƒ¸': { lat: 36.6256, lon: 114.5391 },
            'é‚¢å°': { lat: 37.0682, lon: 114.5048 },
            'ä¿å®š': { lat: 38.8738, lon: 115.4648 },
            'å¼ å®¶å£': { lat: 40.7677, lon: 114.8869 },
            'æ‰¿å¾·': { lat: 40.9510, lon: 117.9636 },
            'æ²§å·': { lat: 38.3037, lon: 116.8388 },
            'å»ŠåŠ': { lat: 39.5380, lon: 116.6831 },
            'è¡¡æ°´': { lat: 37.7389, lon: 115.6701 },

            // ç¦å»ºçœåœ°çº§å¸‚
            'è†ç”°': { lat: 25.4541, lon: 119.0078 },
            'ä¸‰æ˜': { lat: 26.2634, lon: 117.6389 },
            'æ³‰å·': { lat: 24.8738, lon: 118.6754 },
            'æ¼³å·': { lat: 24.5130, lon: 117.6471 },
            'å—å¹³': { lat: 26.6418, lon: 118.1777 },
            'é¾™å²©': { lat: 25.0753, lon: 117.0176 },
            'å®å¾·': { lat: 26.6617, lon: 119.5477 },

            // è¾½å®çœåœ°çº§å¸‚
            'éå±±': { lat: 41.1087, lon: 122.9956 },
            'æŠšé¡º': { lat: 41.8773, lon: 123.9573 },
            'æœ¬æºª': { lat: 41.2886, lon: 123.7663 },
            'ä¸¹ä¸œ': { lat: 40.1290, lon: 124.3854 },
            'é”¦å·': { lat: 41.1301, lon: 121.1269 },
            'è¥å£': { lat: 40.6678, lon: 122.2350 },
            'é˜œæ–°': { lat: 42.0118, lon: 121.6709 },
            'è¾½é˜³': { lat: 41.2698, lon: 123.2376 },
            'ç›˜é”¦': { lat: 41.1190, lon: 122.0707 },
            'é“å²­': { lat: 42.2232, lon: 123.8416 },
            'æœé˜³': { lat: 41.5757, lon: 120.4509 },
            'è‘«èŠ¦å²›': { lat: 40.7430, lon: 120.8365 },
            'æ²ˆé˜³': { lat: 41.8057, lon: 123.4315 },

            // é™•è¥¿çœåœ°çº§å¸‚
            'é“œå·': { lat: 34.8965, lon: 108.9454 },
            'å®é¸¡': { lat: 34.3616, lon: 107.2378 },
            'å’¸é˜³': { lat: 34.3456, lon: 108.7091 },
            'æ¸­å—': { lat: 34.5024, lon: 109.5099 },
            'å»¶å®‰': { lat: 36.5853, lon: 109.4898 },
            'æ±‰ä¸­': { lat: 33.0674, lon: 107.0230 },
            'æ¦†æ—': { lat: 38.2817, lon: 109.7344 },
            'å®‰åº·': { lat: 32.6849, lon: 109.0293 },
            'å•†æ´›': { lat: 33.8689, lon: 109.9402 },

            // å®‰å¾½çœåœ°çº§å¸‚
            'èŠœæ¹–': { lat: 31.3340, lon: 118.3818 },
            'èšŒåŸ ': { lat: 32.9395, lon: 117.3885 },
            'æ·®å—': { lat: 32.6474, lon: 116.9998 },
            'é©¬éå±±': { lat: 31.6705, lon: 118.5067 },
            'æ·®åŒ—': { lat: 33.9717, lon: 116.7947 },
            'é“œé™µ': { lat: 30.9454, lon: 117.8120 },
            'å®‰åº†': { lat: 30.5431, lon: 117.0633 },
            'é»„å±±': { lat: 29.7147, lon: 118.3376 },
            'æ»å·': { lat: 32.3017, lon: 118.3163 },
            'é˜œé˜³': { lat: 32.8899, lon: 115.8142 },
            'å®¿å·': { lat: 33.6461, lon: 116.9642 },
            'å…­å®‰': { lat: 31.7355, lon: 116.5079 },
            'äº³å·': { lat: 33.8693, lon: 115.7785 },
            'æ± å·': { lat: 30.6648, lon: 117.4911 },
            'å®£åŸ': { lat: 30.9404, lon: 118.7589 },

            // æ±Ÿè¥¿çœåœ°çº§å¸‚
            'æ™¯å¾·é•‡': { lat: 29.2687, lon: 117.1784 },
            'èä¹¡': { lat: 27.6227, lon: 113.8520 },
            'ä¹æ±Ÿ': { lat: 29.7051, lon: 116.0013 },
            'æ–°ä½™': { lat: 27.8176, lon: 114.9308 },
            'é¹°æ½­': { lat: 28.2386, lon: 117.0338 },
            'èµ£å·': { lat: 25.8310, lon: 114.9336 },
            'å‰å®‰': { lat: 27.1138, lon: 114.9926 },
            'å®œæ˜¥': { lat: 27.8004, lon: 115.0130 },
            'æŠšå·': { lat: 27.9491, lon: 116.3583 },
            'ä¸Šé¥¶': { lat: 28.4551, lon: 117.9432 },

            // å¹¿è¥¿åœ°çº§å¸‚
            'æŸ³å·': { lat: 24.3264, lon: 109.4281 },
            'æ¡‚æ—': { lat: 25.2736, lon: 110.2900 },
            'æ¢§å·': { lat: 23.4768, lon: 111.2791 },
            'åŒ—æµ·': { lat: 21.4733, lon: 109.1198 },
            'é˜²åŸæ¸¯': { lat: 21.6140, lon: 108.3545 },
            'é’¦å·': { lat: 21.9731, lon: 108.6541 },
            'è´µæ¸¯': { lat: 23.1035, lon: 109.5988 },
            'ç‰æ—': { lat: 22.6367, lon: 110.1810 },
            'ç™¾è‰²': { lat: 23.9025, lon: 106.6182 },
            'è´ºå·': { lat: 24.4033, lon: 111.5521 },
            'æ²³æ± ': { lat: 24.6929, lon: 108.0854 },
            'æ¥å®¾': { lat: 23.7338, lon: 109.2216 },
            'å´‡å·¦': { lat: 22.4060, lon: 107.3643 },

            // äº‘å—çœåœ°çº§å¸‚
            'æ›²é–': { lat: 25.4906, lon: 103.7961 },
            'ç‰æºª': { lat: 24.3520, lon: 102.5466 },
            'ä¿å±±': { lat: 25.1120, lon: 99.1613 },
            'æ˜­é€š': { lat: 27.3380, lon: 103.7172 },
            'ä¸½æ±Ÿ': { lat: 26.8559, lon: 100.2276 },
            'æ™®æ´±': { lat: 22.8250, lon: 100.9660 },
            'ä¸´æ²§': { lat: 23.8864, lon: 100.0870 },
            'æ¥šé›„': { lat: 25.0329, lon: 101.5461 },
            'çº¢æ²³': { lat: 23.3633, lon: 103.3756 },
            'æ–‡å±±': { lat: 23.3695, lon: 104.2440 },
            'è¥¿åŒç‰ˆçº³': { lat: 22.0077, lon: 100.7979 },
            'å¤§ç†': { lat: 25.6065, lon: 100.2677 },
            'å¾·å®': { lat: 24.4365, lon: 98.5784 },
            'æ€’æ±Ÿ': { lat: 25.8522, lon: 98.8567 },
            'è¿ªåº†': { lat: 27.8186, lon: 99.7021 },

            // è´µå·çœåœ°çº§å¸‚
            'å…­ç›˜æ°´': { lat: 26.5933, lon: 104.8305 },
            'éµä¹‰': { lat: 27.7257, lon: 106.9273 },
            'å®‰é¡º': { lat: 26.2530, lon: 105.9476 },
            'æ¯•èŠ‚': { lat: 27.2849, lon: 105.2919 },
            'é“œä»': { lat: 27.7311, lon: 109.1895 },
            'é»”è¥¿å—': { lat: 25.0877, lon: 104.9060 },
            'é»”ä¸œå—': { lat: 26.5836, lon: 107.9829 },
            'é»”å—': { lat: 26.2580, lon: 107.5171 },

            // å±±è¥¿çœåœ°çº§å¸‚
            'å¤§åŒ': { lat: 40.0769, lon: 113.2951 },
            'é˜³æ³‰': { lat: 37.8575, lon: 113.5803 },
            'é•¿æ²»': { lat: 36.1954, lon: 113.1163 },
            'æ™‹åŸ': { lat: 35.4908, lon: 112.8513 },
            'æœ”å·': { lat: 39.3318, lon: 112.4329 },
            'æ™‹ä¸­': { lat: 37.6872, lon: 112.7526 },
            'è¿åŸ': { lat: 35.0226, lon: 111.0070 },
            'å¿»å·': { lat: 38.4177, lon: 112.7335 },
            'ä¸´æ±¾': { lat: 36.0880, lon: 111.5189 },
            'å•æ¢': { lat: 37.5177, lon: 111.1412 },

            // å‰æ—çœåœ°çº§å¸‚
            'å‰æ—': { lat: 43.8378, lon: 126.5496 },
            'å››å¹³': { lat: 43.1666, lon: 124.3508 },
            'è¾½æº': { lat: 42.9024, lon: 125.1453 },
            'é€šåŒ–': { lat: 41.7285, lon: 125.9395 },
            'ç™½å±±': { lat: 41.9374, lon: 126.4148 },
            'æ¾åŸ': { lat: 45.1411, lon: 124.8250 },
            'ç™½åŸ': { lat: 45.6197, lon: 122.8389 },
            'å»¶è¾¹': { lat: 42.8910, lon: 129.5089 },

            // é»‘é¾™æ±Ÿçœåœ°çº§å¸‚
            'é½é½å“ˆå°”': { lat: 47.3543, lon: 123.9180 },
            'é¸¡è¥¿': { lat: 45.2956, lon: 130.9697 },
            'é¹¤å²—': { lat: 47.3492, lon: 130.2977 },
            'åŒé¸­å±±': { lat: 46.6463, lon: 131.1572 },
            'å¤§åº†': { lat: 46.5879, lon: 125.1033 },
            'ä¼Šæ˜¥': { lat: 47.7275, lon: 128.8993 },
            'ä½³æœ¨æ–¯': { lat: 46.7995, lon: 130.3187 },
            'ä¸ƒå°æ²³': { lat: 45.7710, lon: 131.0031 },
            'ç‰¡ä¸¹æ±Ÿ': { lat: 44.5526, lon: 129.6329 },
            'é»‘æ²³': { lat: 50.2456, lon: 127.5286 },
            'ç»¥åŒ–': { lat: 46.6374, lon: 126.9690 },
            'å¤§å…´å®‰å²­': { lat: 52.3353, lon: 124.7118 },

            // å†…è’™å¤åœ°çº§å¸‚
            'åŒ…å¤´': { lat: 40.6574, lon: 109.8403 },
            'ä¹Œæµ·': { lat: 39.6542, lon: 106.7940 },
            'èµ¤å³°': { lat: 42.2573, lon: 118.8869 },
            'é€šè¾½': { lat: 43.6175, lon: 122.2603 },
            'é„‚å°”å¤šæ–¯': { lat: 39.6086, lon: 109.7816 },
            'å‘¼ä¼¦è´å°”': { lat: 49.2122, lon: 119.7659 },
            'å·´å½¦æ·–å°”': { lat: 40.7431, lon: 107.3878 },
            'ä¹Œå…°å¯Ÿå¸ƒ': { lat: 40.9943, lon: 113.1329 },
            'å…´å®‰': { lat: 46.0764, lon: 122.0378 },
            'é”¡æ—éƒ­å‹’': { lat: 43.9333, lon: 116.0462 },
            'é˜¿æ‹‰å–„': { lat: 38.8505, lon: 105.7297 },

            // ç”˜è‚ƒçœåœ°çº§å¸‚
            'å˜‰å³ªå…³': { lat: 39.7726, lon: 98.2773 },
            'é‡‘æ˜Œ': { lat: 38.5204, lon: 102.1879 },
            'ç™½é“¶': { lat: 36.5448, lon: 104.1389 },
            'å¤©æ°´': { lat: 34.5808, lon: 105.7244 },
            'æ­¦å¨': { lat: 37.9283, lon: 102.6371 },
            'å¼ æ–': { lat: 38.9259, lon: 100.4496 },
            'å¹³å‡‰': { lat: 35.5428, lon: 106.6654 },
            'é…’æ³‰': { lat: 39.7238, lon: 98.4941 },
            'åº†é˜³': { lat: 35.7094, lon: 107.6432 },
            'å®šè¥¿': { lat: 35.5806, lon: 104.6262 },
            'é™‡å—': { lat: 33.4012, lon: 104.9217 },
            'ä¸´å¤': { lat: 35.6012, lon: 103.2106 },
            'ç”˜å—': { lat: 34.9863, lon: 102.9110 },

            // é’æµ·çœåœ°çº§å¸‚
            'æµ·ä¸œ': { lat: 36.5029, lon: 102.1029 },

            // å®å¤åœ°çº§å¸‚
            'çŸ³å˜´å±±': { lat: 38.9834, lon: 106.3760 },
            'å´å¿ ': { lat: 37.9976, lon: 106.1992 },
            'å›ºåŸ': { lat: 36.0159, lon: 106.2427 },
            'ä¸­å«': { lat: 37.5149, lon: 105.1967 },

            // æ–°ç–†åœ°çº§å¸‚
            'å…‹æ‹‰ç›ä¾': { lat: 45.5799, lon: 84.8893 },
            'åé²ç•ª': { lat: 42.9513, lon: 89.1895 },
            'å“ˆå¯†': { lat: 42.8332, lon: 93.5147 },
            'æ˜Œå‰': { lat: 44.0115, lon: 87.3080 },
            'åšå°”å¡”æ‹‰': { lat: 44.9053, lon: 82.0749 },
            'å·´éŸ³éƒ­æ¥': { lat: 41.7639, lon: 86.1500 },
            'é˜¿å…‹è‹': { lat: 41.1675, lon: 80.2609 },
            'å…‹å­œå‹’è‹': { lat: 39.7133, lon: 76.1685 },
            'å–€ä»€': { lat: 39.4704, lon: 75.9899 },
            'å’Œç”°': { lat: 37.1098, lon: 79.9269 },
            'ä¼ŠçŠ': { lat: 43.9217, lon: 81.3174 },
            'å¡”åŸ': { lat: 46.7453, lon: 82.9869 },
            'é˜¿å‹’æ³°': { lat: 47.8485, lon: 88.1396 },
            'çŸ³æ²³å­': { lat: 44.3025, lon: 86.0414 },
            'é˜¿æ‹‰å°”': { lat: 40.5419, lon: 81.2859 },
            'å›¾æœ¨èˆ’å…‹': { lat: 39.8673, lon: 79.0740 },
            'äº”å®¶æ¸ ': { lat: 44.1670, lon: 87.5269 },
            'åŒ—å±¯': { lat: 47.3531, lon: 87.8082 },
            'é“é—¨å…³': { lat: 41.8272, lon: 85.5012 },
            'åŒæ²³': { lat: 44.8405, lon: 82.3535 },
            'å¯å…‹è¾¾æ‹‰': { lat: 43.9400, lon: 80.9988 },
            'æ˜†ç‰': { lat: 37.2074, lon: 79.2782 },
            'èƒ¡æ¨æ²³': { lat: 44.6921, lon: 84.8271 },

            // æµ·å—çœåœ°çº§å¸‚
            'ä¸‰äºš': { lat: 18.2524, lon: 109.5119 },
            'ä¸‰æ²™': { lat: 16.8339, lon: 112.3380 },
            'å„‹å·': { lat: 19.5212, lon: 109.5767 },
            'äº”æŒ‡å±±': { lat: 18.7751, lon: 109.5173 },
            'æ–‡æ˜Œ': { lat: 19.6129, lon: 110.7979 },
            'ç¼æµ·': { lat: 19.2582, lon: 110.4664 },
            'ä¸‡å®': { lat: 18.7950, lon: 110.3927 },
            'ä¸œæ–¹': { lat: 19.0959, lon: 108.6536 },

            // ç‰¹åˆ«è¡Œæ”¿åŒº
            'é¦™æ¸¯': { lat: 22.3193, lon: 114.1694 },
            'æ¾³é—¨': { lat: 22.1987, lon: 113.5439 },
            'å°åŒ—': { lat: 25.0330, lon: 121.5654 },

            // äºšæ´²å›½å®¶é¦–éƒ½åŠä¸»è¦åŸå¸‚
            'ä¸œäº¬': { lat: 35.6762, lon: 139.6503 },
            'å¤§é˜ª': { lat: 34.6937, lon: 135.5023 },
            'äº¬éƒ½': { lat: 35.0116, lon: 135.7681 },
            'é¦–å°”': { lat: 37.5665, lon: 126.9780 },
            'é‡œå±±': { lat: 35.1796, lon: 129.0756 },
            'å¹³å£¤': { lat: 39.0392, lon: 125.7625 },
            'ä¹Œå…°å·´æ‰˜': { lat: 47.8863, lon: 106.9057 },
            'æ²³å†…': { lat: 21.0285, lon: 105.8542 },
            'èƒ¡å¿—æ˜å¸‚': { lat: 10.7769, lon: 106.7009 },
            'æ›¼è°·': { lat: 13.7563, lon: 100.5018 },
            'æ¸…è¿ˆ': { lat: 18.7883, lon: 98.9853 },
            'å‰éš†å¡': { lat: 3.1390, lon: 101.6869 },
            'æ–°åŠ å¡': { lat: 1.3521, lon: 103.8198 },
            'é›…åŠ è¾¾': { lat: -6.2088, lon: 106.8456 },
            'é©¬å°¼æ‹‰': { lat: 14.5995, lon: 120.9842 },
            'æ–¯é‡Œå·´åŠ æ¹¾å¸‚': { lat: 4.9031, lon: 114.9396 },
            'ä¸‡è±¡': { lat: 17.9757, lon: 102.6332 },
            'é‡‘è¾¹': { lat: 11.5564, lon: 104.9282 },
            'ä»°å…‰': { lat: 16.8661, lon: 96.1951 },
            'å†…æ¯”éƒ½': { lat: 19.7633, lon: 96.0785 },
            'åŠ å¾·æ»¡éƒ½': { lat: 27.7172, lon: 85.3233 },
            'è¾¾å¡': { lat: 23.8103, lon: 90.4125 },
            'ç§‘ä¼¦å¡': { lat: 6.9271, lon: 79.8612 },
            'ä¼Šæ–¯å…°å ¡': { lat: 33.6844, lon: 73.0479 },
            'å¡æ‹‰å¥‡': { lat: 24.8607, lon: 67.0011 },
            'å–€å¸ƒå°”': { lat: 34.5553, lon: 69.2075 },
            'å¾·é»‘å…°': { lat: 35.6892, lon: 51.3890 },
            'å·´æ ¼è¾¾': { lat: 33.3152, lon: 44.3661 },
            'ç§‘å¨ç‰¹åŸ': { lat: 29.3759, lon: 47.9875 },
            'åˆ©é›…å¾—': { lat: 24.7136, lon: 46.6753 },
            'å¤šå“ˆ': { lat: 25.2854, lon: 51.5310 },
            'é˜¿å¸ƒæ‰æ¯”': { lat: 24.4539, lon: 54.3773 },
            'è¿ªæ‹œ': { lat: 25.2048, lon: 55.2708 },
            'é©¬æ–¯å–€ç‰¹': { lat: 23.5859, lon: 58.3829 },
            'è¨é‚£': { lat: 15.3694, lon: 44.1910 },
            'è€¶è·¯æ’’å†·': { lat: 31.7683, lon: 35.2137 },
            'ç‰¹æ‹‰ç»´å¤«': { lat: 32.0853, lon: 34.7818 },
            'å®‰æ›¼': { lat: 31.9539, lon: 35.9106 },
            'è´é²ç‰¹': { lat: 33.8940, lon: 35.4792 },
            'å¤§é©¬å£«é©': { lat: 33.5138, lon: 36.2765 },
            'å®‰å¡æ‹‰': { lat: 39.9334, lon: 32.8597 },
            'ä¼Šæ–¯å¦å¸ƒå°”': { lat: 41.0082, lon: 28.9784 },
            'å°¼ç§‘è¥¿äºš': { lat: 35.1264, lon: 33.4298 },
            'ç¬¬æ¯”åˆ©æ–¯': { lat: 41.7151, lon: 44.8278 },
            'åŸƒé‡Œæ¸©': { lat: 40.1772, lon: 44.5125 },
            'å·´åº“': { lat: 40.3777, lon: 49.8920 },
            'é˜¿ä»€å“ˆå·´å¾·': { lat: 37.9601, lon: 58.3261 },
            'æœå°šåˆ«': { lat: 38.5598, lon: 68.7870 },
            'æ¯”ä»€å‡¯å…‹': { lat: 42.8746, lon: 74.5698 },
            'å¡”ä»€å¹²': { lat: 41.2995, lon: 69.2401 },
            'é˜¿æ–¯å¡”çº³': { lat: 51.1605, lon: 71.4704 },
            'é˜¿æ‹‰æœ¨å›¾': { lat: 43.2220, lon: 76.8512 },
            'æ–°å¾·é‡Œ': { lat: 28.6139, lon: 77.2090 },
            'å­Ÿä¹°': { lat: 19.0760, lon: 72.8777 },
            'ç­åŠ ç½—å°”': { lat: 12.9716, lon: 77.5946 },

            // æ¬§æ´²å›½å®¶é¦–éƒ½åŠä¸»è¦åŸå¸‚
            'è«æ–¯ç§‘': { lat: 55.7558, lon: 37.6173 },
            'åœ£å½¼å¾—å ¡': { lat: 59.9343, lon: 30.3351 },
            'ä¼¦æ•¦': { lat: 51.5074, lon: -0.1278 },
            'æ›¼å½»æ–¯ç‰¹': { lat: 53.4808, lon: -2.2426 },
            'ä¼¯æ˜ç¿°': { lat: 52.4862, lon: -1.8904 },
            'å·´é»': { lat: 48.8566, lon: 2.3522 },
            'é©¬èµ›': { lat: 43.2965, lon: 5.3698 },
            'é‡Œæ˜‚': { lat: 45.7640, lon: 4.8357 },
            'æŸæ—': { lat: 52.5200, lon: 13.4050 },
            'æ…•å°¼é»‘': { lat: 48.1351, lon: 11.5820 },
            'æ±‰å ¡': { lat: 53.5511, lon: 9.9937 },
            'æ³•å…°å…‹ç¦': { lat: 50.1109, lon: 8.6821 },
            'ç½—é©¬': { lat: 41.9028, lon: 12.4964 },
            'ç±³å…°': { lat: 45.4642, lon: 9.1900 },
            'å¨å°¼æ–¯': { lat: 45.4408, lon: 12.3155 },
            'ä½›ç½—ä¼¦è¨': { lat: 43.7696, lon: 11.2558 },
            'é©¬å¾·é‡Œ': { lat: 40.4168, lon: -3.7038 },
            'å·´å¡ç½—é‚£': { lat: 41.3851, lon: 2.1734 },
            'å¡ç»´åˆ©äºš': { lat: 37.3891, lon: -5.9845 },
            'é‡Œæ–¯æœ¬': { lat: 38.7223, lon: -9.1393 },
            'æ³¢å°”å›¾': { lat: 41.1579, lon: -8.6291 },
            'ç»´ä¹Ÿçº³': { lat: 48.2082, lon: 16.3738 },
            'è¨å°”èŒ¨å ¡': { lat: 47.8095, lon: 13.0550 },
            'é›…å…¸': { lat: 37.9838, lon: 23.7275 },
            'è¨æ´›å°¼å¡': { lat: 40.6401, lon: 22.9444 },
            'é˜¿å§†æ–¯ç‰¹ä¸¹': { lat: 52.3676, lon: 4.9041 },
            'é¹¿ç‰¹ä¸¹': { lat: 51.9225, lon: 4.4792 },
            'å¸ƒé²å¡å°”': { lat: 50.8503, lon: 4.3517 },
            'è‹é»ä¸–': { lat: 47.3769, lon: 8.5417 },
            'æ—¥å†…ç“¦': { lat: 46.2044, lon: 6.1432 },
            'æ–¯å¾·å“¥å°”æ‘©': { lat: 59.3293, lon: 18.0686 },
            'å“¥å¾·å ¡': { lat: 57.7089, lon: 11.9746 },
            'å¥¥æ–¯é™†': { lat: 59.9139, lon: 10.7522 },
            'å‘å°”æ ¹': { lat: 60.3913, lon: 5.3221 },
            'å“¥æœ¬å“ˆæ ¹': { lat: 55.6761, lon: 12.5683 },
            'èµ«å°”è¾›åŸº': { lat: 60.1695, lon: 24.9354 },
            'é›·å…‹é›…æœªå…‹': { lat: 64.1355, lon: -21.8954 },
            'éƒ½æŸæ—': { lat: 53.3498, lon: -6.2603 },
            'åæ²™': { lat: 52.2297, lon: 21.0122 },
            'å…‹æ‹‰ç§‘å¤«': { lat: 50.0647, lon: 19.9450 },
            'å¸ƒæ‹‰æ ¼': { lat: 50.0755, lon: 14.4378 },
            'å¸ƒè¾¾ä½©æ–¯': { lat: 47.4979, lon: 19.0402 },
            'å¸ƒåŠ å‹’æ–¯ç‰¹': { lat: 44.4268, lon: 26.1025 },
            'ç´¢éäºš': { lat: 42.6977, lon: 23.3219 },
            'è´å°”æ ¼è±å¾·': { lat: 44.8176, lon: 20.4590 },
            'è¨æ ¼å‹’å¸ƒ': { lat: 45.8150, lon: 15.9819 },
            'å¢å¸ƒå°”é›…é‚£': { lat: 46.0569, lon: 14.5058 },
            'å¸ƒæ‹‰è¿ªæ–¯æ‹‰å‘': { lat: 48.1486, lon: 17.1077 },
            'ç»´å°”çº½æ–¯': { lat: 54.6872, lon: 25.2797 },
            'é‡ŒåŠ ': { lat: 56.9496, lon: 24.1052 },
            'å¡”æ—': { lat: 59.4370, lon: 24.7536 },
            'åŸºè¾…': { lat: 50.4501, lon: 30.5234 },
            'æ•–å¾·è¨': { lat: 46.4825, lon: 30.7233 },
            'æ˜æ–¯å…‹': { lat: 53.9000, lon: 27.5667 },
            'åŸºå¸Œè®·ä¹Œ': { lat: 47.0056, lon: 28.8614 },

            // åŒ—ç¾æ´²å›½å®¶é¦–éƒ½åŠä¸»è¦åŸå¸‚
            'åç››é¡¿': { lat: 38.9072, lon: -77.0369 },
            'çº½çº¦': { lat: 40.7128, lon: -74.0060 },
            'æ´›æ‰çŸ¶': { lat: 34.0522, lon: -118.2437 },
            'èŠåŠ å“¥': { lat: 41.8781, lon: -87.6298 },
            'ä¼‘æ–¯é¡¿': { lat: 29.7604, lon: -95.3698 },
            'è´¹åŸ': { lat: 39.9526, lon: -75.1652 },
            'å‡¤å‡°åŸ': { lat: 33.4484, lon: -112.0740 },
            'æ—§é‡‘å±±': { lat: 37.7749, lon: -122.4194 },
            'è¥¿é›…å›¾': { lat: 47.6062, lon: -122.3321 },
            'æ³¢å£«é¡¿': { lat: 42.3601, lon: -71.0589 },
            'è¿ˆé˜¿å¯†': { lat: 25.7617, lon: -80.1918 },
            'äºšç‰¹å…°å¤§': { lat: 33.7490, lon: -84.3880 },
            'ä¸¹ä½›': { lat: 39.7392, lon: -104.9903 },
            'æ‹‰æ–¯ç»´åŠ æ–¯': { lat: 36.1699, lon: -115.1398 },
            'æ¸¥å¤ªå': { lat: 45.4215, lon: -75.6972 },
            'å¤šä¼¦å¤š': { lat: 43.6532, lon: -79.3832 },
            'æ¸©å“¥å': { lat: 49.2827, lon: -123.1207 },
            'è’™ç‰¹åˆ©å°”': { lat: 45.5017, lon: -73.5673 },
            'å¢¨è¥¿å“¥åŸ': { lat: 19.4326, lon: -99.1332 },
            'åæ˜†': { lat: 21.1619, lon: -86.8515 },

            // å—ç¾æ´²å›½å®¶é¦–éƒ½åŠä¸»è¦åŸå¸‚
            'å·´è¥¿åˆ©äºš': { lat: -15.8267, lon: -47.9218 },
            'åœ£ä¿ç½—': { lat: -23.5505, lon: -46.6333 },
            'é‡Œçº¦çƒ­å†…å¢': { lat: -22.9068, lon: -43.1729 },
            'å¸ƒå®œè¯ºæ–¯è‰¾åˆ©æ–¯': { lat: -34.6037, lon: -58.3816 },
            'åˆ©é©¬': { lat: -12.0464, lon: -77.0428 },
            'æ³¢å“¥å¤§': { lat: 4.7110, lon: -74.0721 },
            'åœ£åœ°äºšå“¥': { lat: -33.4489, lon: -70.6693 },
            'åŠ æ‹‰åŠ æ–¯': { lat: 10.4806, lon: -66.9036 },
            'è’™å¾—ç»´çš„äºš': { lat: -34.9011, lon: -56.1645 },
            'äºšæ¾æ£®': { lat: -25.2868, lon: -57.6392 },
            'æ‹‰å·´æ–¯': { lat: -16.4897, lon: -68.1193 },
            'è‹å…‹é›·': { lat: -19.0426, lon: -65.2559 },
            'åŸºå¤š': { lat: -0.1807, lon: -78.4678 },
            'å¸•æ‹‰é©¬é‡Œåš': { lat: 5.8520, lon: -55.2038 },
            'å¡å®´': { lat: 4.9333, lon: -52.3333 },
            'ä¹”æ²»æ•¦': { lat: 6.8013, lon: -58.1551 },

            // å¤§æ´‹æ´²å›½å®¶é¦–éƒ½åŠä¸»è¦åŸå¸‚
            'å ªåŸ¹æ‹‰': { lat: -35.2809, lon: 149.1300 },
            'æ‚‰å°¼': { lat: -33.8688, lon: 151.2093 },
            'å¢¨å°”æœ¬': { lat: -37.8136, lon: 144.9631 },
            'å¸ƒé‡Œæ–¯ç­': { lat: -27.4698, lon: 153.0251 },
            'ç€æ–¯': { lat: -31.9505, lon: 115.8605 },
            'é˜¿å¾·è±å¾·': { lat: -34.9285, lon: 138.6007 },
            'æƒ çµé¡¿': { lat: -41.2924, lon: 174.7787 },
            'å¥¥å…‹å…°': { lat: -36.8485, lon: 174.7633 },
            'è‹ç“¦': { lat: -18.1248, lon: 178.4501 },
            'è«å°”æ–¯æ¯”æ¸¯': { lat: -9.4438, lon: 147.1803 },

            // éæ´²å›½å®¶é¦–éƒ½åŠä¸»è¦åŸå¸‚
            'å¼€ç½—': { lat: 30.0444, lon: 31.2357 },
            'äºšå†å±±å¤§': { lat: 31.2001, lon: 29.9187 },
            'æ‹‰å„æ–¯': { lat: 6.5244, lon: 3.3792 },
            'çº¦ç¿°å†…æ–¯å ¡': { lat: -26.2041, lon: 28.0473 },
            'å¼€æ™®æ•¦': { lat: -33.9249, lon: 18.4241 },
            'å¾·ç­': { lat: -29.8587, lon: 31.0218 },
            'å†…ç½—æ¯•': { lat: -1.2921, lon: 36.8219 },
            'é˜¿å…‹æ‹‰': { lat: 5.6037, lon: -0.1870 },
            'å¡è¨å¸ƒå…°å¡': { lat: 33.5731, lon: -7.5898 },
            'æ‹‰å·´ç‰¹': { lat: 34.0209, lon: -6.8416 },
            'é˜¿å°”åŠå°”': { lat: 36.7538, lon: 3.0588 },
            'çªå°¼æ–¯': { lat: 36.8065, lon: 10.1815 },
            'çš„é»æ³¢é‡Œ': { lat: 32.8872, lon: 13.1913 },
            'ç“¦åŠ æœå¤': { lat: 12.2383, lon: -1.5616 },
            'å·´é©¬ç§‘': { lat: 12.6392, lon: -8.0029 },
            'è¾¾å–€å°”': { lat: 14.7167, lon: -17.4677 },
            'é˜¿æ¯”è®©': { lat: 5.3600, lon: -3.7872 },
            'æ´›ç¾': { lat: 6.1287, lon: 1.2254 },
            'ç§‘æ‰˜åŠª': { lat: 6.3971, lon: 2.4211 },
            'é˜¿å¸ƒè´¾': { lat: 9.0579, lon: 7.4951 },
            'é›…æ¸©å¾—': { lat: 3.8780, lon: 11.5136 },
            'åˆ©ä¼¯ç»´å°”': { lat: 0.3919, lon: 9.4536 },
            'å¸ƒæ‹‰æŸ´ç»´å°”': { lat: -4.2634, lon: 15.2429 },
            'é‡‘æ²™è¨': { lat: -4.4419, lon: 15.2663 },
            'åå¸•æ‹‰': { lat: 0.3476, lon: 32.5825 },
            'åŸºåŠ åˆ©': { lat: -1.9403, lon: 29.8739 },
            'å¸ƒç¼å¸ƒæ‹‰': { lat: -3.3818, lon: 29.3622 },
            'è¾¾ç´¯æ–¯è¨æ‹‰å§†': { lat: -6.7924, lon: 39.2083 },
            'å¢è¨å¡': { lat: -15.4167, lon: 28.2833 },
            'å“ˆæ‹‰é›·': { lat: -17.8292, lon: 31.0522 },
            'é©¬æ™®æ‰˜': { lat: -25.9692, lon: 32.5732 },
            'æ¸©å¾—å’Œå…‹': { lat: -22.5597, lon: 17.0832 },
            'åŠ åšç½—å†…': { lat: -24.6541, lon: 25.9085 },
            'å§†å·´å·´çº³': { lat: -26.3164, lon: 31.1410 },
        };

        // å¤©æ°”ä»£ç åˆ°ä¸­æ–‡æè¿°çš„æ˜ å°„
        const weatherCodeMap = {
            0: 'æ™´æœ—',
            1: 'å¤§éƒ¨æ™´æœ—',
            2: 'å¤šäº‘',
            3: 'é˜´å¤©',
            45: 'æœ‰é›¾',
            48: 'é›¾å‡‡',
            51: 'æ¯›æ¯›é›¨',
            53: 'ä¸­åº¦æ¯›æ¯›é›¨',
            55: 'æµ“æ¯›æ¯›é›¨',
            56: 'å†»æ¯›æ¯›é›¨',
            57: 'å¼ºå†»æ¯›æ¯›é›¨',
            61: 'å°é›¨',
            63: 'ä¸­é›¨',
            65: 'å¤§é›¨',
            66: 'å†»é›¨',
            67: 'å¼ºå†»é›¨',
            71: 'å°é›ª',
            73: 'ä¸­é›ª',
            75: 'å¤§é›ª',
            77: 'é›ªç²’',
            80: 'é˜µé›¨',
            81: 'ä¸­åº¦é˜µé›¨',
            82: 'æš´é›¨',
            85: 'å°é˜µé›ª',
            86: 'å¤§é˜µé›ª',
            95: 'é›·æš´',
            96: 'é›·æš´ä¼´æœ‰å†°é›¹',
            99: 'å¼ºé›·æš´ä¼´æœ‰å†°é›¹'
        };

        // è®¡ç®—ä¸¤ä¸ªåæ ‡ä¹‹é—´çš„è·ç¦»ï¼ˆHaversineå…¬å¼ï¼Œå•ä½ï¼šåƒç±³ï¼‰
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // åœ°çƒåŠå¾„ï¼Œå•ä½ï¼šåƒç±³
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // æŸ¥æ‰¾è·ç¦»æŒ‡å®šåæ ‡æœ€è¿‘çš„åŸå¸‚
        function findNearestCity(targetLat, targetLon) {
            let nearestCity = null;
            let minDistance = Infinity;

            for (const [cityName, coords] of Object.entries(cityCoordinates)) {
                const distance = calculateDistance(targetLat, targetLon, coords.lat, coords.lon);
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestCity = { name: cityName, distance: distance };
                }
            }

            return nearestCity;
        }

        // ä½¿ç”¨ Open-Meteo API è·å–å¤©æ°”æ•°æ®
        async function getWeatherData(city) {
            // æ£€æŸ¥ç¼“å­˜
            const cached = cachedWeather[city];
            const now = Date.now();
            if (cached && (now - cached.timestamp) < WEATHER_CACHE_DURATION) {
                console.log('ä½¿ç”¨ç¼“å­˜çš„å¤©æ°”æ•°æ®');
                return cached.data;
            }

            // è·å–åŸå¸‚åæ ‡
            let coords = cityCoordinates[city];
            let actualCity = city;
            let isNearestCity = false;

            if (!coords) {
                console.log('æœªæ‰¾åˆ°åŸå¸‚åæ ‡:', city);
                return null;
            }

            try {
                // æ·»åŠ è¶…æ—¶æ§åˆ¶
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000); // 8ç§’è¶…æ—¶

                // ä½¿ç”¨ Open-Meteo API (å…è´¹ï¼Œæ— éœ€API key)
                const url = `https://api.open-meteo.com/v1/forecast?latitude=${coords.lat}&longitude=${coords.lon}&current=temperature_2m,relative_humidity_2m,apparent_temperature,weather_code,wind_speed_10m&wind_speed_unit=kmh&timezone=auto`;

                const response = await fetch(url, {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    const current = data.current;

                    const weatherData = {
                        temp_C: Math.round(current.temperature_2m),
                        weatherDesc: weatherCodeMap[current.weather_code] || 'æœªçŸ¥',
                        humidity: current.relative_humidity_2m,
                        windSpeed: Math.round(current.wind_speed_10m),
                        feelsLike: Math.round(current.apparent_temperature),
                        actualCity: actualCity,
                        isNearestCity: isNearestCity
                    };

                    // ç¼“å­˜æ•°æ®
                    cachedWeather[city] = {
                        data: weatherData,
                        timestamp: now
                    };

                    return weatherData;
                }
                return null;
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('å¤©æ°”è¯·æ±‚è¶…æ—¶');
                }
                // å¦‚æœæœ‰ç¼“å­˜æ•°æ®ï¼Œå³ä½¿è¿‡æœŸä¹Ÿè¿”å›
                if (cached) {
                    console.log('ä½¿ç”¨è¿‡æœŸçš„ç¼“å­˜æ•°æ®');
                    return cached.data;
                }
                throw error;
            }
        }

        // å°è¯•é€šè¿‡åœ°ç†ç¼–ç APIè·å–åŸå¸‚åæ ‡
        async function getCityCoordinates(city) {
            try {
                // ä½¿ç”¨Open-Meteoçš„åœ°ç†ç¼–ç APIï¼ˆå…è´¹ï¼Œæ— éœ€API keyï¼‰
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3ç§’è¶…æ—¶

                const url = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(city)}&count=1&language=zh&format=json`;

                const response = await fetch(url, {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    if (data.results && data.results.length > 0) {
                        const result = data.results[0];
                        return {
                            lat: result.latitude,
                            lon: result.longitude,
                            name: result.name,
                            country: result.country
                        };
                    }
                }
                return null;
            } catch (error) {
                console.log('è·å–åŸå¸‚åæ ‡å¤±è´¥:', error.message);
                return null;
            }
        }

        // è·å–å¯„è¯­æ•°æ®ï¼ˆéšæœºåŒ–ï¼Œä¸ä½¿ç”¨ç¼“å­˜ï¼‰
        async function getQuoteData(mood, customText) {
            if (mood === 'custom') {
                return generateCustomAdvice(customText);
            }

            // æ¯æ¬¡éƒ½è·å–æ–°å¯„è¯­ï¼Œä¸ä½¿ç”¨ç¼“å­˜ï¼Œç¡®ä¿éšæœºæ€§
            return await getQuoteByMood(mood);
        }

        function showCitySuggestions(cities) {
            const suggestionDiv = document.getElementById('citySuggestion');
            const listDiv = document.getElementById('citySuggestionList');
            listDiv.innerHTML = '';
            cities.forEach(city => {
                const btn = document.createElement('button');
                btn.className = 'city-suggestion-btn';
                btn.textContent = city;
                btn.onclick = () => {
                    document.getElementById('city').value = city;
                    suggestionDiv.classList.remove('show');
                    getWeatherAndQuote();
                };
                listDiv.appendChild(btn);
            });
            suggestionDiv.classList.add('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        // å›è½¦é”®æäº¤
        document.getElementById('city').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                getWeatherAndQuote();
            }
        });

        // é¡µé¢åŠ è½½æ—¶é¢„åŠ è½½ä¸€äº›åœ¨çº¿å¯„è¯­åˆ°ç¼“å­˜ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
        async function preloadQuotes() {
            // å»¶è¿Ÿæ‰§è¡Œï¼Œä¸é˜»å¡é¡µé¢åŠ è½½
            setTimeout(async () => {
                try {
                    // å¹¶è¡Œé¢„åŠ è½½å¤šä¸ªåˆ†ç±»ï¼ˆåˆ é™¤ dailyï¼‰
                    const moods = ['happy', 'sad', 'motivational'];
                    const promises = moods.map(mood =>
                        fetchOnlineQuote(mood).then(quote => {
                            if (quote) {
                                cachedQuotes[mood] = {
                                    quote: quote,
                                    timestamp: Date.now()
                                };
                                console.log(`é¢„åŠ è½½ ${mood} å¯„è¯­æˆåŠŸ`);
                            }
                        }).catch(err => {
                            console.log(`${mood} é¢„åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°è¯­åº“`);
                        })
                    );

                    await Promise.all(promises);
                    console.log('å¯„è¯­é¢„åŠ è½½å®Œæˆ');
                } catch (error) {
                    console.log('é¢„åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°è¯­åº“');
                }
            }, 2000); // 2ç§’åå¼€å§‹é¢„åŠ è½½
        }

        // é¢„åŠ è½½ä¸»è¦åŸå¸‚çš„å¤©æ°”
        async function preloadMajorCitiesWeather() {
            console.log('å¼€å§‹é¢„åŠ è½½ä¸»è¦åŸå¸‚å¤©æ°”...');
            const startTime = Date.now();

            // å¹¶è¡Œé¢„åŠ è½½æ‰€æœ‰ä¸»è¦åŸå¸‚
            const promises = majorCitiesForPreload.map(city =>
                getWeatherData(city).catch(err => {
                    console.log(`${city} å¤©æ°”é¢„åŠ è½½å¤±è´¥`);
                })
            );

            await Promise.all(promises);
            const elapsed = Date.now() - startTime;
            console.log(`ä¸»è¦åŸå¸‚å¤©æ°”é¢„åŠ è½½å®Œæˆï¼Œè€—æ—¶ ${elapsed}ms`);
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºå¯åŠ¨ç”»é¢
        window.addEventListener('load', async () => {
            // åœ¨æ˜¾ç¤ºå¯åŠ¨ç”»é¢çš„åŒæ—¶ï¼Œåå°é¢„åŠ è½½å¤©æ°”å’Œå¯„è¯­
            showSplashScreen();
            preloadQuotes();
            preloadMajorCitiesWeather();
        });

        // æ˜¾ç¤ºå¯åŠ¨ç”»é¢
        function showSplashScreen() {
            const splashScreen = document.getElementById('splashScreen');
            const splashQuote = document.getElementById('splashQuote');
            const splashAuthor = document.getElementById('splashAuthor');
            const mainContent = document.getElementById('mainContent');

            // è·å–æ¯æ—¥å¯„è¯­ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ï¼‰
            fetchOnlineQuote('daily').then(onlineQuote => {
                if (onlineQuote) {
                    splashQuote.textContent = `"${onlineQuote.text}"`;
                    if (onlineQuote.author) {
                        splashAuthor.textContent = `â€”â€” ${onlineQuote.author}`;
                    }
                } else {
                    // ä½¿ç”¨æœ¬åœ°æ¯æ—¥å¯„è¯­
                    const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
                    const dailyQuotes = [
                        { text: "æ¯ä¸€å¤©éƒ½æ˜¯ä¸€ä¸ªæ–°çš„æœºä¼šï¼ŒæŠŠæ¡ä»Šå¤©å°±èƒ½åˆ›é€ ç¾å¥½çš„æ˜å¤©ã€‚", author: "" },
                        { text: "ä¸å…¶æ‹…å¿ƒæœªæ¥ï¼Œä¸å¦‚ä¸“æ³¨å½“ä¸‹ï¼Œåšå¥½æ‰‹å¤´çš„äº‹ã€‚", author: "" },
                        { text: "ç›¸ä¿¡è‡ªå·±ï¼Œä½ å·²ç»æ¯”æ˜¨å¤©æ›´å¼ºå¤§äº†ã€‚", author: "" },
                        { text: "ç”Ÿæ´»ä¸æ˜¯ç­‰å¾…æš´é£é›¨è¿‡å»ï¼Œè€Œæ˜¯å­¦ä¼šåœ¨é›¨ä¸­è·³èˆã€‚", author: "" },
                        { text: "å³ä½¿èµ°å¾—æ…¢ï¼Œåªè¦åšæŒå‘å‰ï¼Œç»ˆç©¶ä¼šåˆ°è¾¾ç›®çš„åœ°ã€‚", author: "" },
                        { text: "ä»Šå¤©çš„åŠªåŠ›æ˜¯æ˜å¤©çš„æ”¶è·ï¼Œç»§ç»­åŠ æ²¹ï¼", author: "" },
                        { text: "å¾®ç¬‘é¢å¯¹æ¯ä¸€å¤©ï¼Œå¥½è¿è‡ªç„¶ä¼šæ¥æ•²é—¨ã€‚", author: "" }
                    ];
                    const quote = dailyQuotes[dayOfYear % dailyQuotes.length];
                    splashQuote.textContent = `"${quote.text}"`;
                    if (quote.author) {
                        splashAuthor.textContent = `â€”â€” ${quote.author}`;
                    }
                }
            }).catch(error => {
                console.log('è·å–æ¯æ—¥å¯„è¯­å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å¯„è¯­');
                splashQuote.textContent = "\"æ¯ä¸€å¤©éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å¼€å§‹ï¼Œæ„¿ä»Šå¤©å……æ»¡é˜³å…‰å’Œå¸Œæœ›ã€‚\"";
            });

            // 3ç§’åéšè—å¯åŠ¨ç”»é¢
            setTimeout(() => {
                splashScreen.classList.add('hidden');

                // åŠ¨ç”»å®Œæˆåç§»é™¤å¯åŠ¨ç”»é¢DOM
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                }, 800);
            }, 3000);
        }
    </script>
</body>
</html>
