<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿ƒæƒ…å¤©æ°”ç«™</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
            animation: fadeIn 0.5s ease-in;
            display: block !important;
            opacity: 1 !important;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
        }

        .update-status {
            background: #e8f5e9;
            border-radius: 10px;
            padding: 10px 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 14px;
            color: #2e7d32;
        }

        .update-status.updating {
            background: #fff3e0;
            color: #e65100;
        }

        .update-status.error {
            background: #ffebee;
            color: #c62828;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #555;
            font-weight: 500;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .mood-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .mood-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 24px;
        }

        .mood-btn:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .mood-btn.selected {
            border-color: #667eea;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .mood-btn span {
            display: block;
            font-size: 14px;
            margin-top: 5px;
        }

        .custom-mood-input {
            margin-top: 15px;
            display: none;
        }

        .custom-mood-input.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .submit-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            margin-top: 10px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .result {
            margin-top: 30px;
            display: none;
        }

        .result.show {
            display: block;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .weather-card {
            background: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
            border-radius: 15px;
            padding: 20px;
            color: white;
            margin-bottom: 20px;
        }

        .weather-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .city-name {
            font-size: 24px;
            font-weight: 600;
        }

        .temperature {
            font-size: 48px;
            font-weight: 700;
        }

        .weather-details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            font-size: 14px;
        }

        .quote-card {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            border-radius: 15px;
            padding: 25px;
            color: #333;
        }

        .quote-text {
            font-size: 18px;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .quote-author {
            text-align: right;
            font-weight: 600;
            color: #666;
        }

        .quote-source {
            text-align: right;
            font-size: 12px;
            color: #999;
            margin-top: 5px;
        }

        .city-suggestion {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-top: 10px;
            display: none;
        }

        .city-suggestion.show {
            display: block;
        }

        .city-suggestion-title {
            font-weight: 600;
            color: #856404;
            margin-bottom: 10px;
        }

        .city-suggestion-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .city-suggestion-btn {
            padding: 8px 15px;
            background: white;
            border: 1px solid #ffc107;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .city-suggestion-btn:hover {
            background: #ffc107;
            color: white;
        }

        .error-message {
            background: #ff6b6b;
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .quote-tags {
            display: flex;
            gap: 8px;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .quote-tag {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
        }

        /* å¯åŠ¨ç”»é¢æ ·å¼ */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 1;
            transition: opacity 0.8s ease-out, visibility 0.8s;
        }

        .splash-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }

        .splash-content {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 50px 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: splashFadeIn 0.8s ease-out;
        }

        @keyframes splashFadeIn {
            from {
                opacity: 0;
                transform: scale(0.9);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .splash-icon {
            font-size: 60px;
            margin-bottom: 20px;
        }

        .splash-quote {
            font-size: 24px;
            line-height: 1.8;
            color: #333;
            margin-bottom: 20px;
            font-weight: 500;
        }

        .splash-author {
            font-size: 16px;
            color: #666;
            font-style: italic;
        }

        .splash-timer {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 14px;
        }

        .main-content {
            /* ä¸å½±å“ä¸»ç•Œé¢æ˜¾ç¤º */
        }
    </style>
</head>
<body>
    <!-- å¯åŠ¨ç”»é¢ -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <div class="splash-icon">âœ¨</div>
            <div class="splash-quote" id="splashQuote">æ­£åœ¨åŠ è½½æ¯æ—¥å¯„è¯­...</div>
            <div class="splash-author" id="splashAuthor"></div>
        </div>
        <div class="splash-timer">æ¯æ—¥å¿ƒè¯­</div>
    </div>

    <!-- ä¸»ç•Œé¢ -->
    <div class="main-content" id="mainContent">
        <div class="container">
            <h1>ğŸŒ¤ï¸ å¿ƒæƒ…å¤©æ°”ç«™</h1>

        <div class="form-group">
            <label for="city">è¾“å…¥æ‚¨çš„åŸå¸‚ï¼š</label>
            <input type="text" id="city" placeholder="ä¾‹å¦‚ï¼šåŒ—äº¬ã€ä¸Šæµ·ã€å¹¿å·...">
        </div>

        <div class="form-group">
            <label>é€‰æ‹©æ‚¨çš„å¿ƒæƒ…ï¼š</label>
            <div class="mood-options">
                <button class="mood-btn" data-mood="happy">
                    ğŸ˜Š<span>å¼€å¿ƒ</span>
                </button>
                <button class="mood-btn" data-mood="sad">
                    ğŸ˜¢<span>éš¾è¿‡</span>
                </button>
                <button class="mood-btn" data-mood="anxious">
                    ğŸ˜°<span>ç„¦è™‘</span>
                </button>
                <button class="mood-btn" data-mood="tired">
                    ğŸ˜´<span>ç–²æƒ«</span>
                </button>
                <button class="mood-btn" data-mood="excited">
                    ğŸ¤©<span>å…´å¥‹</span>
                </button>
                <button class="mood-btn" data-mood="confused">
                    ğŸ˜•<span>è¿·èŒ«</span>
                </button>
                <button class="mood-btn" data-mood="custom">
                    ğŸ’­<span>å…¶ä»–</span>
                </button>
            </div>

            <div class="custom-mood-input" id="customMoodInput">
                <label for="customMood">å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„å¿ƒæƒ…ï¼š</label>
                <textarea id="customMood" placeholder="è¯´è¯´æ‚¨ç°åœ¨çš„æ„Ÿå—ï¼Œæ¯”å¦‚ï¼šä»Šå¤©å·¥ä½œå‹åŠ›å¾ˆå¤§ã€å’Œå¥½æœ‹å‹åµæ¶äº†ã€è€ƒè¯•æ²¡è€ƒå¥½..."></textarea>
            </div>
        </div>

        <button class="submit-btn" onclick="getWeatherAndQuote()">æŸ¥çœ‹å¤©æ°”</button>

        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>æ­£åœ¨è·å–å¤©æ°”ä¿¡æ¯...</p>
        </div>

        <div class="city-suggestion" id="citySuggestion">
            <div class="city-suggestion-title">ğŸ¤” æ²¡æ‰¾åˆ°è¯¥åŸå¸‚ï¼Œè¯•è¯•è¿™äº›ï¼Ÿ</div>
            <div class="city-suggestion-list" id="citySuggestionList"></div>
        </div>

        <div class="result" id="result">
            <div class="weather-card">
                <div class="weather-header">
                    <div class="city-name" id="cityName"></div>
                    <div class="temperature" id="temperature"></div>
                </div>
                <div class="weather-details">
                    <div>å¤©æ°”: <span id="weatherDesc"></span></div>
                    <div>æ¹¿åº¦: <span id="humidity"></span></div>
                    <div>é£é€Ÿ: <span id="windSpeed"></span></div>
                    <div>ä½“æ„Ÿ: <span id="feelsLike"></span></div>
                </div>
            </div>

            <div class="quote-card">
                <div class="quote-text" id="quoteText"></div>
                <div class="quote-author" id="quoteAuthor"></div>
                <div class="quote-source" id="quoteSource"></div>
            </div>
        </div>

        <div class="error-message" id="errorMessage"></div>
        </div>
    </div>

    <script>
        let selectedMood = null;
        let customMoodText = '';
        let cachedQuotes = {};
        let cachedWeather = {};
        let lastUpdateCheck = 0;
        const UPDATE_CHECK_INTERVAL = 24 * 60 * 60 * 1000; // 24å°æ—¶
        const WEATHER_CACHE_DURATION = 10 * 60 * 1000; // å¤©æ°”ç¼“å­˜10åˆ†é’Ÿ

        // ä¸»è¦åŸå¸‚åˆ—è¡¨ï¼ˆç”¨äºé¢„åŠ è½½ï¼‰
        const majorCitiesForPreload = [
            'åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·', 'æˆéƒ½', 'é‡åº†', 'æ­¦æ±‰', 'è¥¿å®‰', 'å—äº¬',
            'å¤©æ´¥', 'è‹å·', 'é•¿æ²™', 'éƒ‘å·', 'ä¸œè', 'é’å²›', 'æ²ˆé˜³', 'å®æ³¢', 'æ˜†æ˜', 'åˆè‚¥'
        ];

        // å¿ƒæƒ…æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.mood-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mood-btn').forEach(b => b.classList.remove('selected'));
                this.classList.add('selected');
                selectedMood = this.dataset.mood;

                const customInput = document.getElementById('customMoodInput');
                if (selectedMood === 'custom') {
                    customInput.classList.add('show');
                } else {
                    customInput.classList.remove('show');
                }
            });
        });

        // ç›‘å¬è‡ªå®šä¹‰å¿ƒæƒ…è¾“å…¥
        document.getElementById('customMood').addEventListener('input', function(e) {
            customMoodText = e.target.value.trim();
        });

        // æ™ºèƒ½å¼€å¯¼æ•°æ®åº“
        const adviceDatabase = {
            keywords: {
                'å·¥ä½œ': "å·¥ä½œç¡®å®é‡è¦ï¼Œä½†åˆ«å¿˜äº†å·¥ä½œæ˜¯ä¸ºäº†æ›´å¥½çš„ç”Ÿæ´»ã€‚é€‚å½“ç»™è‡ªå·±æ”¾ä¸ªå‡ï¼Œå……ç”µåå†å‡ºå‘ï¼Œä½ ä¼šå‘ç°æ•ˆç‡æ›´é«˜ã€‚",
                'å­¦ä¹ ': "å­¦ä¹ æ˜¯ä¸€åœºé©¬æ‹‰æ¾ï¼Œä¸æ˜¯çŸ­è·‘ã€‚ä»Šå¤©çš„åŠªåŠ›éƒ½ä¸ä¼šç™½è´¹ï¼Œåªæ˜¯ç»“æœå¯èƒ½éœ€è¦æ—¶é—´ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œç»§ç»­å‰è¿›ï¼",
                'è€ƒè¯•': "è€ƒè¯•åªæ˜¯æ£€éªŒå­¦ä¹ çš„ä¸€ç§æ–¹å¼ï¼Œä¸èƒ½å®šä¹‰ä½ çš„å…¨éƒ¨ã€‚å°½åŠ›å°±å¥½ï¼Œç»“æœå¦‚ä½•éƒ½ä¸å½±å“ä½ æ˜¯ä¸€ä¸ªä¼˜ç§€çš„äººã€‚",
                'å‹åŠ›': "å‹åŠ›è¯´æ˜ä½ åœ¨ä¹ï¼Œä½†åˆ«è®©å‹åŠ›å‹å®äº†ä½ ã€‚è¯•ç€æŠŠå¤§ä»»åŠ¡åˆ†è§£æˆå°æ­¥éª¤ï¼Œä¸€æ­¥ä¸€æ­¥æ¥ï¼Œä½ ä¼šå‘ç°æ²¡é‚£ä¹ˆéš¾ã€‚",
                'åŠ ç­': "åŠ ç­æ˜¯æš‚æ—¶çš„ï¼Œå¥åº·æ˜¯ä¸€ç”Ÿçš„ã€‚è®°ä½ï¼Œä½ çš„ä»·å€¼ä¸åœ¨äºå·¥ä½œäº†å¤šå°‘å°æ—¶ï¼Œè€Œåœ¨äºä½ åˆ›é€ äº†ä»€ä¹ˆä»·å€¼ã€‚",
                'å¤±ä¸š': "å¤±ä¸šå¯èƒ½æ˜¯ä¸€ä¸ªè½¬æŠ˜ç‚¹ï¼Œä¹Ÿæ˜¯é‡æ–°å®¡è§†è‡ªå·±çš„æœºä¼šã€‚å¾ˆå¤šäººåœ¨å¤±å»å·¥ä½œåæ‰¾åˆ°äº†æ›´é€‚åˆè‡ªå·±çš„äººç”Ÿé“è·¯ã€‚",
                'åµæ¶': "åµæ¶æ˜¯å› ä¸ºæ²Ÿé€šä¸ç•…ï¼Œå†·é™ä¸‹æ¥åè¯•ç€ç†è§£å¯¹æ–¹çš„ç«‹åœºã€‚çŸ›ç›¾æ˜¯å…³ç³»çš„ä¸€éƒ¨åˆ†ï¼Œé‡è¦çš„æ˜¯å¦‚ä½•è§£å†³å®ƒã€‚",
                'åˆ†æ‰‹': "ç»“æŸä¸€æ®µå…³ç³»å¾ˆéš¾ï¼Œä½†æœ‰æ—¶å€™æ”¾æ‰‹ä¹Ÿæ˜¯å¯¹è‡ªå·±çš„ä¸€ç§ä¿æŠ¤ã€‚æ—¶é—´ä¼šæ²»æ„ˆä¸€åˆ‡ï¼Œä½ ä¼šé‡åˆ°æ›´é€‚åˆçš„äººã€‚",
                'å­¤ç‹¬': "å­¤ç‹¬æ„Ÿæ˜¯æ¯ä¸ªäººéƒ½ä¼šç»å†çš„ï¼Œå®ƒæé†’æˆ‘ä»¬éœ€è¦ä¸ä»–äººå»ºç«‹è¿æ¥ã€‚è¯•ç€ä¸»åŠ¨è”ç³»è€æœ‹å‹ï¼Œæˆ–è€…å‚åŠ å…´è¶£å°ç»„ã€‚",
                'æœ‹å‹': "æœ‹å‹ä¸åœ¨å¤šï¼Œåœ¨äºçœŸå¿ƒã€‚çæƒœé‚£äº›åœ¨ä½ å›°éš¾æ—¶ä¾ç„¶é™ªä¼´ä½ çš„äººï¼Œä»–ä»¬æ‰æ˜¯çœŸæ­£çš„æœ‹å‹ã€‚",
                'å®¶äºº': "å®¶äººä¹‹é—´å¯èƒ½æœ‰çŸ›ç›¾ï¼Œä½†è¡€æµ“äºæ°´ã€‚è¯•ç€ç”¨ç†è§£å’ŒåŒ…å®¹å»åŒ–è§£ï¼Œå®¶æ°¸è¿œæ˜¯ä½ æœ€æ¸©æš–çš„æ¸¯æ¹¾ã€‚",
                'éš¾è¿‡': "éš¾è¿‡çš„æ—¶å€™å…è®¸è‡ªå·±å“­å‡ºæ¥ï¼Œè¿™æ˜¯æƒ…ç»ªçš„è‡ªç„¶æµéœ²ã€‚å“­å®Œä¹‹åï¼Œè®°å¾—æ“¦å¹²çœ¼æ³ªï¼Œç»§ç»­å‰è¡Œã€‚",
                'ç”Ÿæ°”': "ç”Ÿæ°”æ˜¯å¯ä»¥çš„ï¼Œä½†åˆ«è®©æ„¤æ€’æ§åˆ¶ä½ çš„è¡Œä¸ºã€‚æ·±å‘¼å¸ï¼Œæ•°åˆ°åï¼Œå†åšå†³å®šã€‚ä¸è¦åœ¨æ°”å¤´ä¸Šè¯´åæ‚”çš„è¯ã€‚",
                'å¤±æœ›': "å¤±æœ›æºäºæœŸæœ›ï¼Œä¹Ÿè®¸æ˜¯æ—¶å€™è°ƒæ•´æœŸæœ›äº†ã€‚ä¸æ˜¯æ¯ä»¶äº‹éƒ½ä¼šæŒ‰è®¡åˆ’è¿›è¡Œï¼Œå­¦ä¼šæ¥å—ä¸å®Œç¾ä¹Ÿæ˜¯æˆé•¿ã€‚",
                'å®³æ€•': "å®³æ€•è¯´æ˜ä½ åœ¨ä¹ï¼Œä½†ä¸è¦è®©ææƒ§é˜»æ­¢ä½ å°è¯•ã€‚æœ€å›°éš¾çš„æ˜¯ç¬¬ä¸€æ­¥ï¼Œè·¨è¿‡å»åä½ ä¼šå‘ç°æ²¡é‚£ä¹ˆå¯æ€•ã€‚",
                'è‡ªå‘': "æ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„é—ªå…‰ç‚¹ï¼Œä¹Ÿè®¸ä½ è¿˜æ²¡å‘ç°ã€‚åˆ«æ€»æ‹¿è‡ªå·±çš„çŸ­å¤„å’Œåˆ«äººçš„é•¿å¤„æ¯”ï¼Œä½ æ˜¯ç‹¬ä¸€æ— äºŒçš„ã€‚",
                'å¤±è´¥': "å¤±è´¥ä¸æ˜¯ç»ˆç‚¹ï¼Œè€Œæ˜¯æˆåŠŸçš„å«è„šçŸ³ã€‚æ¯æ¬¡å¤±è´¥éƒ½è®©ä½ ç¦»æˆåŠŸæ›´è¿‘ä¸€æ­¥ï¼Œåªè¦ä½ ä¸æ”¾å¼ƒã€‚",
                'åæ‚”': "åæ‚”æ”¹å˜ä¸äº†è¿‡å»ï¼Œä½†å¯ä»¥å½±å“æœªæ¥ã€‚ä»é”™è¯¯ä¸­å­¦ä¹ ï¼Œç„¶åæ”¾è¿‡è‡ªå·±ï¼Œç»§ç»­å‰è¿›ã€‚",
                'è¿·èŒ«': "è¿·èŒ«æ—¶åˆ«æ€¥ç€åšå†³å®šï¼Œç»™è‡ªå·±ä¸€äº›æ—¶é—´ã€‚å¤šå°è¯•ä¸åŒçš„äº‹ç‰©ï¼Œç­”æ¡ˆä¼šåœ¨è¡ŒåŠ¨ä¸­é€æ¸æ¸…æ™°ã€‚"
            },
            default: [
                "ä¸ç®¡ä½ ç°åœ¨ç»å†äº†ä»€ä¹ˆï¼Œè®°ä½ï¼šè¿™ä¸ªéš¾å…³åªæ˜¯æš‚æ—¶çš„ï¼Œä½ ä¼šè¿‡å»çš„ã€‚ç›¸ä¿¡è‡ªå·±ï¼Œä½ æ¯”æƒ³è±¡ä¸­æ›´åšå¼ºã€‚",
                "ç”Ÿæ´»ä¸­æ€»ä¼šæœ‰èµ·èµ·è½è½ï¼Œè¿™æ˜¯å¸¸æ€ã€‚é‡è¦çš„æ˜¯åœ¨ä½è°·æ—¶ä¸è¦æ”¾å¼ƒï¼Œå› ä¸ºä¸‹ä¸€ä¸ªè½¬è§’å¯èƒ½å°±æ˜¯ä¸Šå¡è·¯ã€‚",
                "æ¯ä¸ªäººéƒ½æœ‰ä½è°·æœŸï¼Œè¿™ä¸ä»£è¡¨ä½ ä¸å¤Ÿå¥½ã€‚ç»™è‡ªå·±ä¸€äº›æ—¶é—´å’Œè€å¿ƒï¼Œé˜³å…‰æ€»åœ¨é£é›¨åã€‚",
                "ä½ ç°åœ¨å¯èƒ½è§‰å¾—å¾ˆç´¯ã€å¾ˆéš¾ï¼Œä½†è¿™äº›æ„Ÿå—éƒ½æ˜¯æš‚æ—¶çš„ã€‚ç¡ä¸ªå¥½è§‰ï¼Œæ˜å¤©åˆæ˜¯æ–°çš„ä¸€å¤©ã€‚",
                "è®°ä½ï¼Œä½ ä¸éœ€è¦æ—¶åˆ»ä¿æŒåšå¼ºã€‚è„†å¼±ä¹Ÿæ²¡å…³ç³»ï¼Œç´¯äº†å°±ä¼‘æ¯ï¼Œéš¾è¿‡äº†å°±å“­å‡ºæ¥ã€‚æ˜å¤©å¤ªé˜³ä¾ç„¶ä¼šå‡èµ·ã€‚"
            ]
        };

        function generateCustomAdvice(userInput) {
            const input = userInput.toLowerCase();
            for (const [keyword, advice] of Object.entries(adviceDatabase.keywords)) {
                if (input.includes(keyword)) {
                    return { text: advice, author: "ç»™ä½ çš„å»ºè®®", source: "æœ¬åœ°æ™ºèƒ½å¼€å¯¼" };
                }
            }
            const randomIndex = Math.floor(Math.random() * adviceDatabase.default.length);
            return { text: adviceDatabase.default[randomIndex], author: "ç»™ä½ çš„å»ºè®®", source: "æœ¬åœ°æ™ºèƒ½å¼€å¯¼" };
        }

        // åœ¨çº¿APIè·å–å¯„è¯­ï¼ˆä¼˜åŒ–ç‰ˆï¼Œå¸¦è¶…æ—¶ï¼‰
        async function fetchOnlineQuote(mood) {
            try {
                // ä½¿ç”¨ Quotable API (å…è´¹ï¼Œæ— éœ€API key)
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000); // 3ç§’è¶…æ—¶

                const response = await fetch('https://api.quotable.io/quotes/random?limit=1&tags=' + getQuoteTag(mood), {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    },
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    if (data && data_quotes && data_quotes.length > 0) {
                        const quote = data_quotes[0];
                        return {
                            text: quote.content,
                            author: quote.author || "",
                            source: "Quotable API"
                        };
                    }
                }
                throw new Error('APIè¿”å›ä¸ºç©º');
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('åœ¨çº¿APIè¯·æ±‚è¶…æ—¶ï¼Œä½¿ç”¨æœ¬åœ°è¯­åº“');
                } else {
                    console.log('åœ¨çº¿APIè·å–å¤±è´¥:', error.message);
                }
                return null;
            }
        }

        // æ ¹æ®å¿ƒæƒ…è·å–å¯¹åº”çš„æ ‡ç­¾
        function getQuoteTag(mood) {
            const tagMap = {
                'happy': 'wisdom,happiness',
                'sad': 'hope,faith',
                'anxious': 'courage,determination',
                'tired': 'motivation,perseverance',
                'excited': 'ambition,success',
                'confused': 'wisdom,truth',
                'daily': 'inspirational'
            };
            return tagMap[mood] || 'inspirational';
        }

        // è·å–æ¯æ—¥å¯„è¯­ï¼ˆç»“åˆåœ¨çº¿APIï¼‰
        async function getDailyQuote() {
            const today = new Date().toDateString();

            // æ£€æŸ¥ç¼“å­˜
            if (cachedQuotes['daily'] && cachedQuotes['daily'].date === today) {
                return cachedQuotes['daily'].quote;
            }

            // å°è¯•ä»åœ¨çº¿APIè·å–
            const onlineQuote = await fetchOnlineQuote('daily');
            if (onlineQuote) {
                cachedQuotes['daily'] = {
                    quote: onlineQuote,
                    date: today
                };
                return onlineQuote;
            }

            // å¤‡ç”¨ï¼šä½¿ç”¨æœ¬åœ°æ¯æ—¥å¯„è¯­
            const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
            const dailyQuotes = [
                { text: "æ¯ä¸€å¤©éƒ½æ˜¯ä¸€ä¸ªæ–°çš„æœºä¼šï¼ŒæŠŠæ¡ä»Šå¤©å°±èƒ½åˆ›é€ ç¾å¥½çš„æ˜å¤©ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "ä¸å…¶æ‹…å¿ƒæœªæ¥ï¼Œä¸å¦‚ä¸“æ³¨å½“ä¸‹ï¼Œåšå¥½æ‰‹å¤´çš„äº‹ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "ç›¸ä¿¡è‡ªå·±ï¼Œä½ å·²ç»æ¯”æ˜¨å¤©æ›´å¼ºå¤§äº†ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "ç”Ÿæ´»ä¸æ˜¯ç­‰å¾…æš´é£é›¨è¿‡å»ï¼Œè€Œæ˜¯å­¦ä¼šåœ¨é›¨ä¸­è·³èˆã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "å³ä½¿èµ°å¾—æ…¢ï¼Œåªè¦åšæŒå‘å‰ï¼Œç»ˆç©¶ä¼šåˆ°è¾¾ç›®çš„åœ°ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "ä»Šå¤©çš„åŠªåŠ›æ˜¯æ˜å¤©çš„æ”¶è·ï¼Œç»§ç»­åŠ æ²¹ï¼", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" },
                { text: "å¾®ç¬‘é¢å¯¹æ¯ä¸€å¤©ï¼Œå¥½è¿è‡ªç„¶ä¼šæ¥æ•²é—¨ã€‚", author: "æ¯æ—¥å¯„è¯­", source: "æœ¬åœ°è¯­åº“" }
            ];

            const quote = dailyQuotes[dayOfYear % dailyQuotes.length];
            cachedQuotes['daily'] = {
                quote: quote,
                date: today
            };
            return quote;
        }

        // è·å–æŒ‡å®šå¿ƒæƒ…çš„å¯„è¯­ï¼ˆéšæœºåŒ–ï¼‰
        async function getQuoteByMood(mood) {
            // ä¼˜å…ˆå°è¯•åœ¨çº¿APIï¼ˆå¸¦éšæœºæ€§ï¼‰
            const onlineQuote = await fetchOnlineQuote(mood);
            if (onlineQuote) {
                // åœ¨çº¿APIæœ¬èº«å°±è¿”å›éšæœºå¯„è¯­
                return onlineQuote;
            }

            // å¤‡ç”¨ï¼šä½¿ç”¨æœ¬åœ°è¯­åº“ï¼ˆéšæœºé€‰æ‹©ï¼‰
            const localQuotes = {
                happy: [
                    { text: "å¿«ä¹ä¸æ˜¯å› ä¸ºæ‹¥æœ‰çš„å¤šï¼Œè€Œæ˜¯å› ä¸ºè®¡è¾ƒçš„å°‘ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ç”Ÿå‘½ä¸­æœ€å¤§çš„å¿«ä¹æ˜¯ç¡®ä¿¡æœ‰äººçˆ±ç€æˆ‘ä»¬ã€‚", author: "é›¨æœ", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ä¿æŒå¿«ä¹ï¼Œä½ ä¼šå‘ç°ä¸–ç•Œä¹Ÿåœ¨å¯¹ä½ å¾®ç¬‘ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "å¿«ä¹æ˜¯ä¸€ç§é€‰æ‹©ï¼Œé€‰æ‹©å¾®ç¬‘ï¼Œä¸–ç•Œä¼šå› ä½ è€Œç¾å¥½ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "å¿«ä¹å°±åœ¨å½“ä¸‹ï¼Œçæƒœçœ¼å‰çš„ç¾å¥½æ—¶å…‰ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                sad: [
                    { text: "å³ä½¿æœ€è‰°éš¾çš„æ—¥å­ï¼Œä¹Ÿä¼šè¿‡å»ã€‚å¤ªé˜³ä¼šå†æ¬¡å‡èµ·ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ¯ä¸€ä¸ªä¸æ›¾èµ·èˆçš„æ—¥å­ï¼Œéƒ½æ˜¯å¯¹ç”Ÿå‘½çš„è¾œè´Ÿã€‚", author: "å°¼é‡‡", source: "æœ¬åœ°è¯­åº“" },
                    { text: "çœ¼æ³ªæ˜¯å¿ƒçµçš„æ¸…æ´å‰‚ï¼Œè®©å®ƒæµï¼Œç„¶åç»§ç»­å‰è¡Œã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "å›°éš¾æ˜¯æˆé•¿çš„é˜¶æ¢¯ï¼Œå‹‡æ•¢åœ°è·¨è¿‡å»ï¼Œä½ ä¼šæ›´å¼ºå¤§ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ä»Šæ™šçš„æ³ªæ°´ä¼šæˆä¸ºæ˜å¤©çš„åŠ›é‡ï¼ŒåŠ æ²¹ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                anxious: [
                    { text: "ä¸è¦é¢„æ”¯æ˜å¤©çš„çƒ¦æ¼ï¼Œä»Šå¤©å·²ç»å¤Ÿå¿™äº†ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "åƒé‡Œä¹‹è¡Œï¼Œå§‹äºè¶³ä¸‹ã€‚", author: "è€å­", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ç„¦è™‘ä¸ä¼šæ¶ˆé™¤æ˜å¤©çš„æ‚²ä¼¤ï¼Œåªä¼šæ¶ˆå‡ä»Šå¤©çš„åŠ›é‡ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ·±å‘¼å¸ï¼Œæ”¾æ¾å¿ƒæƒ…ï¼Œä¸€åˆ‡éƒ½ä¼šå¥½èµ·æ¥çš„ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ‹…å¿ƒä¸ä¼šæ”¹å˜ç»“æœï¼Œä½†è¡ŒåŠ¨ä¼šã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                tired: [
                    { text: "ä¼‘æ¯ä¸æ˜¯æ”¾å¼ƒï¼Œè€Œæ˜¯ä¸ºäº†æ›´å¥½åœ°å‡ºå‘ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "äººç”Ÿå°±åƒé©¬æ‹‰æ¾ï¼Œé‡è¦çš„ä¸æ˜¯é€Ÿåº¦ï¼Œè€Œæ˜¯åšæŒã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ç´¯çš„æ—¶å€™ï¼Œå…è®¸è‡ªå·±åœä¸‹æ¥ï¼Œé˜³å…‰ä¾ç„¶ä¼šç…§åœ¨ä½ èº«ä¸Šã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "é€‚å½“ä¼‘æ¯ä¸æ˜¯å·æ‡’ï¼Œè€Œæ˜¯ä¸ºäº†èµ°å¾—æ›´è¿œã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "èº«ä½“ç´¯äº†å°±ä¼‘æ¯ï¼Œå¿ƒç´¯äº†å°±æ”¾ä¸‹ï¼Œæ˜å¤©åˆæ˜¯æ–°çš„å¼€å§‹ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                excited: [
                    { text: "ä¿æŒè¿™ä»½çƒ­æƒ…ï¼Œå®ƒå°†å¸¦ä½ å»å¾€æ¢¦æƒ³çš„å½¼å²¸ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ¿€æƒ…æ˜¯æˆåŠŸçš„ç‡ƒæ–™ï¼Œè®©å®ƒç‡ƒçƒ§å¾—æ›´çŒ›çƒˆäº›å§ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ¯ä¸€ä¸ªä¼Ÿå¤§çš„æˆå°±ï¼Œéƒ½å§‹äºä¸€ä»½æ¿€æƒ…ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "å°†è¿™ä»½å…´å¥‹è½¬åŒ–ä¸ºè¡ŒåŠ¨ï¼Œåˆ›é€ å±äºä½ çš„ç²¾å½©ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æ­¤åˆ»çš„æ¿€æƒ…æ˜¯ä½ æˆåŠŸçš„ç§å­ï¼Œå¥½å¥½åŸ¹è‚²å®ƒã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ],
                confused: [
                    { text: "è¿·èŒ«çš„æ—¶å€™ï¼Œé™ä¸‹å¿ƒæ¥ï¼Œç­”æ¡ˆå°±åœ¨ä½ å¿ƒä¸­ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "è·¯æ˜¯èµ°å‡ºæ¥çš„ï¼Œä¸æ˜¯æƒ³å‡ºæ¥çš„ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åœ¨è¿·é›¾ä¸­æ‰èƒ½æ‰¾åˆ°çœŸæ­£çš„æ–¹å‘ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "è¿·èŒ«å¹¶ä¸å¯æ€•ï¼Œå¯æ€•çš„æ˜¯åœæ»ä¸å‰ã€‚", author: "", source: "æœ¬åœ°è¯­åº“" },
                    { text: "ä¸å…¶åœ¨è¿·èŒ«ä¸­å¾˜å¾Šï¼Œä¸å¦‚åœ¨è¡ŒåŠ¨ä¸­å¯»æ‰¾ç­”æ¡ˆã€‚", author: "", source: "æœ¬åœ°è¯­åº“" }
                ]
            };

            const quotes = localQuotes[mood] || localQuotes['happy'];
            // ä½¿ç”¨å½“å‰æ—¶é—´æˆ³ä½œä¸ºéšæœºç§å­ï¼Œç¡®ä¿æ¯æ¬¡éƒ½ä¸åŒ
            const randomIndex = Math.floor(Math.random() * quotes.length);
            return quotes[randomIndex];
        }

        // ä¸»è¦åŸå¸‚åˆ—è¡¨
        const majorCities = [
            'åŒ—äº¬', 'ä¸Šæµ·', 'å¹¿å·', 'æ·±åœ³', 'æ­å·', 'æˆéƒ½', 'é‡åº†', 'æ­¦æ±‰', 'è¥¿å®‰', 'å—äº¬',
            'å¤©æ´¥', 'è‹å·', 'é•¿æ²™', 'éƒ‘å·', 'ä¸œè', 'é’å²›', 'æ²ˆé˜³', 'å®æ³¢', 'æ˜†æ˜', 'åˆè‚¥',
            'ç¦å·', 'å¦é—¨', 'å“ˆå°”æ»¨', 'æµå—', 'å¤§è¿', 'é•¿æ˜¥', 'å¤ªåŸ', 'è´µé˜³', 'å—æ˜Œ', 'å—å®',
            'çŸ³å®¶åº„', 'å…°å·', 'ä¹Œé²æœ¨é½', 'å‘¼å’Œæµ©ç‰¹', 'æµ·å£', 'é“¶å·', 'è¥¿å®', 'æ‹‰è¨', 'å°åŒ—',
            'é¦™æ¸¯', 'æ¾³é—¨'
        ];

        function findSimilarCities(input) {
            const inputLower = input.toLowerCase();
            const similarities = majorCities.map(city => {
                let score = 0;
                const cityLower = city.toLowerCase();
                if (cityLower.includes(inputLower) || inputLower.includes(cityLower)) {
                    score = 3;
                } else if (inputLower.length > 0 && cityLower.includes(inputLower[0])) {
                    score = 1;
                }
                return { city, score };
            }).filter(item => item.score > 0)
              .sort((a, b) => b.score - a.score)
              .slice(0, 6)
              .map(item => item.city);
            return similarities;
        }

        async function getWeatherAndQuote() {
            const city = document.getElementById('city').value.trim();
            const resultDiv = document.getElementById('result');
            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('errorMessage');
            const citySuggestion = document.getElementById('citySuggestion');

            resultDiv.classList.remove('show');
            errorDiv.classList.remove('show');
            citySuggestion.classList.remove('show');

            if (!city) {
                showError('è¯·è¾“å…¥åŸå¸‚åç§°');
                return;
            }

            if (!selectedMood) {
                showError('è¯·é€‰æ‹©æ‚¨çš„å¿ƒæƒ…');
                return;
            }

            if (selectedMood === 'custom' && !customMoodText) {
                showError('è¯·å‘Šè¯‰æˆ‘ä»¬æ‚¨çš„å¿ƒæƒ…');
                return;
            }

            loadingDiv.classList.add('show');

            try {
                // å¹¶è¡Œè¯·æ±‚ï¼šå¤©æ°”å’Œå¯„è¯­åŒæ—¶è·å–
                const weatherPromise = getWeatherData(city);
                const quotePromise = getQuoteData(selectedMood, customMoodText);

                // ç­‰å¾…ä¸¤ä¸ªè¯·æ±‚éƒ½å®Œæˆ
                const [weatherData, quote] = await Promise.all([
                    weatherPromise,
                    quotePromise
                ]);

                // æ£€æŸ¥å¤©æ°”æ•°æ®
                if (!weatherData) {
                    loadingDiv.classList.remove('show');
                    const similarCities = findSimilarCities(city);
                    if (similarCities.length > 0) {
                        showCitySuggestions(similarCities);
                    } else {
                        showError('æ— æ³•è·å–å¤©æ°”ä¿¡æ¯ï¼Œè¯·æ£€æŸ¥åŸå¸‚åç§°æ˜¯å¦æ­£ç¡®');
                    }
                    return;
                }

                // æ˜¾ç¤ºå¤©æ°”ä¿¡æ¯
                document.getElementById('cityName').textContent = city;
                document.getElementById('temperature').textContent = `${weatherData.temp_C}Â°C`;
                document.getElementById('weatherDesc').textContent = weatherData.weatherDesc;
                document.getElementById('humidity').textContent = `${weatherData.humidity}%`;
                document.getElementById('windSpeed').textContent = `${weatherData.windSpeed} km/h`;
                document.getElementById('feelsLike').textContent = `${weatherData.feelsLike}Â°C`;

                // æ˜¾ç¤ºå¯„è¯­
                document.getElementById('quoteText').textContent = `"${quote.text}"`;

                const authorElement = document.getElementById('quoteAuthor');
                if (quote.author) {
                    authorElement.textContent = `â€”â€” ${quote.author}`;
                    authorElement.style.display = 'block';
                } else {
                    authorElement.style.display = 'none';
                }

                const sourceElement = document.getElementById('quoteSource');
                sourceElement.textContent = `æ¥æº: ${quote.source}`;
                sourceElement.style.display = 'block';

                loadingDiv.classList.remove('show');
                resultDiv.classList.add('show');

            } catch (error) {
                loadingDiv.classList.remove('show');
                const similarCities = findSimilarCities(city);
                if (similarCities.length > 0) {
                    showCitySuggestions(similarCities);
                } else {
                    showError(error.message || 'è·å–ä¿¡æ¯å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
                }
            }
        }

        // è·å–å¤©æ°”æ•°æ®ï¼ˆå¸¦ç¼“å­˜ï¼‰
        async function getWeatherData(city) {
            // æ£€æŸ¥ç¼“å­˜
            const cached = cachedWeather[city];
            const now = Date.now();
            if (cached && (now - cached.timestamp) < WEATHER_CACHE_DURATION) {
                console.log('ä½¿ç”¨ç¼“å­˜çš„å¤©æ°”æ•°æ®');
                return cached.data;
            }

            try {
                // æ·»åŠ è¶…æ—¶æ§åˆ¶
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 8000); // 8ç§’è¶…æ—¶

                const response = await fetch(`https://wttr.in/${encodeURIComponent(city)}?format=j1`, {
                    signal: controller.signal
                });
                clearTimeout(timeoutId);

                if (response.ok) {
                    const data = await response.json();
                    const current = data.current_condition[0];

                    const weatherData = {
                        temp_C: current.temp_C,
                        weatherDesc: current.lang_zh[0]?.value || current.weatherDesc[0].value,
                        humidity: current.humidity,
                        windSpeed: current.windspeedKmph,
                        feelsLike: current.FeelsLikeC
                    };

                    // ç¼“å­˜æ•°æ®
                    cachedWeather[city] = {
                        data: weatherData,
                        timestamp: now
                    };

                    return weatherData;
                }
                return null;
            } catch (error) {
                if (error.name === 'AbortError') {
                    console.log('å¤©æ°”è¯·æ±‚è¶…æ—¶');
                }
                // å¦‚æœæœ‰ç¼“å­˜æ•°æ®ï¼Œå³ä½¿è¿‡æœŸä¹Ÿè¿”å›
                if (cached) {
                    console.log('ä½¿ç”¨è¿‡æœŸçš„ç¼“å­˜æ•°æ®');
                    return cached.data;
                }
                throw error;
            }
        }

        // è·å–å¯„è¯­æ•°æ®ï¼ˆéšæœºåŒ–ï¼Œä¸ä½¿ç”¨ç¼“å­˜ï¼‰
        async function getQuoteData(mood, customText) {
            if (mood === 'custom') {
                return generateCustomAdvice(customText);
            }

            // æ¯æ¬¡éƒ½è·å–æ–°å¯„è¯­ï¼Œä¸ä½¿ç”¨ç¼“å­˜ï¼Œç¡®ä¿éšæœºæ€§
            return await getQuoteByMood(mood);
        }

        function showCitySuggestions(cities) {
            const suggestionDiv = document.getElementById('citySuggestion');
            const listDiv = document.getElementById('citySuggestionList');
            listDiv.innerHTML = '';
            cities.forEach(city => {
                const btn = document.createElement('button');
                btn.className = 'city-suggestion-btn';
                btn.textContent = city;
                btn.onclick = () => {
                    document.getElementById('city').value = city;
                    suggestionDiv.classList.remove('show');
                    getWeatherAndQuote();
                };
                listDiv.appendChild(btn);
            });
            suggestionDiv.classList.add('show');
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.classList.add('show');
        }

        // å›è½¦é”®æäº¤
        document.getElementById('city').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                getWeatherAndQuote();
            }
        });

        // é¡µé¢åŠ è½½æ—¶é¢„åŠ è½½ä¸€äº›åœ¨çº¿å¯„è¯­åˆ°ç¼“å­˜ï¼ˆä¼˜åŒ–ç‰ˆï¼‰
        async function preloadQuotes() {
            // å»¶è¿Ÿæ‰§è¡Œï¼Œä¸é˜»å¡é¡µé¢åŠ è½½
            setTimeout(async () => {
                try {
                    // å¹¶è¡Œé¢„åŠ è½½å¤šä¸ªåˆ†ç±»ï¼ˆåˆ é™¤ dailyï¼‰
                    const moods = ['happy', 'sad', 'motivational'];
                    const promises = moods.map(mood =>
                        fetchOnlineQuote(mood).then(quote => {
                            if (quote) {
                                cachedQuotes[mood] = {
                                    quote: quote,
                                    timestamp: Date.now()
                                };
                                console.log(`é¢„åŠ è½½ ${mood} å¯„è¯­æˆåŠŸ`);
                            }
                        }).catch(err => {
                            console.log(`${mood} é¢„åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°è¯­åº“`);
                        })
                    );

                    await Promise.all(promises);
                    console.log('å¯„è¯­é¢„åŠ è½½å®Œæˆ');
                } catch (error) {
                    console.log('é¢„åŠ è½½å¤±è´¥ï¼Œå°†ä½¿ç”¨æœ¬åœ°è¯­åº“');
                }
            }, 2000); // 2ç§’åå¼€å§‹é¢„åŠ è½½
        }

        // é¢„åŠ è½½ä¸»è¦åŸå¸‚çš„å¤©æ°”
        async function preloadMajorCitiesWeather() {
            console.log('å¼€å§‹é¢„åŠ è½½ä¸»è¦åŸå¸‚å¤©æ°”...');
            const startTime = Date.now();

            // å¹¶è¡Œé¢„åŠ è½½æ‰€æœ‰ä¸»è¦åŸå¸‚
            const promises = majorCitiesForPreload.map(city =>
                getWeatherData(city).catch(err => {
                    console.log(`${city} å¤©æ°”é¢„åŠ è½½å¤±è´¥`);
                })
            );

            await Promise.all(promises);
            const elapsed = Date.now() - startTime;
            console.log(`ä¸»è¦åŸå¸‚å¤©æ°”é¢„åŠ è½½å®Œæˆï¼Œè€—æ—¶ ${elapsed}ms`);
        }

        // é¡µé¢åŠ è½½å®Œæˆåæ˜¾ç¤ºå¯åŠ¨ç”»é¢
        window.addEventListener('load', async () => {
            // åœ¨æ˜¾ç¤ºå¯åŠ¨ç”»é¢çš„åŒæ—¶ï¼Œåå°é¢„åŠ è½½å¤©æ°”å’Œå¯„è¯­
            showSplashScreen();
            preloadQuotes();
            preloadMajorCitiesWeather();
        });

        // æ˜¾ç¤ºå¯åŠ¨ç”»é¢
        function showSplashScreen() {
            const splashScreen = document.getElementById('splashScreen');
            const splashQuote = document.getElementById('splashQuote');
            const splashAuthor = document.getElementById('splashAuthor');
            const mainContent = document.getElementById('mainContent');

            // è·å–æ¯æ—¥å¯„è¯­ï¼ˆå¼‚æ­¥ï¼Œä¸é˜»å¡ï¼‰
            fetchOnlineQuote('daily').then(onlineQuote => {
                if (onlineQuote) {
                    splashQuote.textContent = `"${onlineQuote.text}"`;
                    if (onlineQuote.author) {
                        splashAuthor.textContent = `â€”â€” ${onlineQuote.author}`;
                    }
                } else {
                    // ä½¿ç”¨æœ¬åœ°æ¯æ—¥å¯„è¯­
                    const dayOfYear = Math.floor((new Date() - new Date(new Date().getFullYear(), 0, 0)) / 1000 / 60 / 60 / 24);
                    const dailyQuotes = [
                        { text: "æ¯ä¸€å¤©éƒ½æ˜¯ä¸€ä¸ªæ–°çš„æœºä¼šï¼ŒæŠŠæ¡ä»Šå¤©å°±èƒ½åˆ›é€ ç¾å¥½çš„æ˜å¤©ã€‚", author: "" },
                        { text: "ä¸å…¶æ‹…å¿ƒæœªæ¥ï¼Œä¸å¦‚ä¸“æ³¨å½“ä¸‹ï¼Œåšå¥½æ‰‹å¤´çš„äº‹ã€‚", author: "" },
                        { text: "ç›¸ä¿¡è‡ªå·±ï¼Œä½ å·²ç»æ¯”æ˜¨å¤©æ›´å¼ºå¤§äº†ã€‚", author: "" },
                        { text: "ç”Ÿæ´»ä¸æ˜¯ç­‰å¾…æš´é£é›¨è¿‡å»ï¼Œè€Œæ˜¯å­¦ä¼šåœ¨é›¨ä¸­è·³èˆã€‚", author: "" },
                        { text: "å³ä½¿èµ°å¾—æ…¢ï¼Œåªè¦åšæŒå‘å‰ï¼Œç»ˆç©¶ä¼šåˆ°è¾¾ç›®çš„åœ°ã€‚", author: "" },
                        { text: "ä»Šå¤©çš„åŠªåŠ›æ˜¯æ˜å¤©çš„æ”¶è·ï¼Œç»§ç»­åŠ æ²¹ï¼", author: "" },
                        { text: "å¾®ç¬‘é¢å¯¹æ¯ä¸€å¤©ï¼Œå¥½è¿è‡ªç„¶ä¼šæ¥æ•²é—¨ã€‚", author: "" }
                    ];
                    const quote = dailyQuotes[dayOfYear % dailyQuotes.length];
                    splashQuote.textContent = `"${quote.text}"`;
                    if (quote.author) {
                        splashAuthor.textContent = `â€”â€” ${quote.author}`;
                    }
                }
            }).catch(error => {
                console.log('è·å–æ¯æ—¥å¯„è¯­å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å¯„è¯­');
                splashQuote.textContent = "\"æ¯ä¸€å¤©éƒ½æ˜¯ä¸€ä¸ªæ–°çš„å¼€å§‹ï¼Œæ„¿ä»Šå¤©å……æ»¡é˜³å…‰å’Œå¸Œæœ›ã€‚\"";
            });

            // 3ç§’åéšè—å¯åŠ¨ç”»é¢
            setTimeout(() => {
                splashScreen.classList.add('hidden');

                // åŠ¨ç”»å®Œæˆåç§»é™¤å¯åŠ¨ç”»é¢DOM
                setTimeout(() => {
                    splashScreen.style.display = 'none';
                }, 800);
            }, 3000);
        }
    </script>
</body>
</html>
